#!/bin/bash
# å°†è®­ç»ƒå¥½çš„æ¨¡åž‹éƒ¨ç½²åˆ°LM Studio

set -e

echo "=================================================="
echo "ðŸš€ éƒ¨ç½²è®­ç»ƒå¥½çš„æ¨¡åž‹åˆ°LM Studio"
echo "=================================================="
echo ""

# æºè·¯å¾„
SOURCE_ADAPTER="/Users/plutoguo/Desktop/training/adapters_v2"
BASE_MODEL="/Users/plutoguo/.lmstudio/models/lmstudio-community/Qwen3-VL-30B-Medical-Finetuned"

# ç›®æ ‡è·¯å¾„ - åœ¨LM Studioæ¨¡åž‹ç›®å½•åˆ›å»ºæ–°ç‰ˆæœ¬
TARGET_DIR="/Users/plutoguo/.lmstudio/models/lmstudio-community/Qwen3-VL-30B-Medical-V2-Accuracy"

echo "ðŸ“¦ æºadapterè·¯å¾„: $SOURCE_ADAPTER"
echo "ðŸ“¦ åŸºç¡€æ¨¡åž‹è·¯å¾„: $BASE_MODEL"
echo "ðŸŽ¯ ç›®æ ‡è·¯å¾„: $TARGET_DIR"
echo ""

# æ£€æŸ¥æºæ–‡ä»¶
if [ ! -f "$SOURCE_ADAPTER/adapters.safetensors" ]; then
    echo "âŒ æ‰¾ä¸åˆ°è®­ç»ƒå¥½çš„adapteræ–‡ä»¶"
    exit 1
fi

echo "âœ… Adapteræ–‡ä»¶å­˜åœ¨"
echo ""

# åˆ›å»ºç›®æ ‡ç›®å½•
echo "ðŸ“ åˆ›å»ºç›®æ ‡ç›®å½•..."
mkdir -p "$TARGET_DIR"

# å¤åˆ¶åŸºç¡€æ¨¡åž‹æ–‡ä»¶ï¼ˆè½¯é“¾æŽ¥ä»¥èŠ‚çœç©ºé—´ï¼‰
echo "ðŸ”— é“¾æŽ¥åŸºç¡€æ¨¡åž‹æ–‡ä»¶..."
if [ -d "$BASE_MODEL" ]; then
    # å¤åˆ¶é…ç½®æ–‡ä»¶
    for file in "$BASE_MODEL"/*.json "$BASE_MODEL"/*.txt "$BASE_MODEL"/*.md; do
        if [ -f "$file" ]; then
            cp "$file" "$TARGET_DIR/" 2>/dev/null || true
        fi
    done
    
    # é“¾æŽ¥æ¨¡åž‹æƒé‡ï¼ˆèŠ‚çœç©ºé—´ï¼‰
    for file in "$BASE_MODEL"/*.safetensors "$BASE_MODEL"/*.gguf; do
        if [ -f "$file" ]; then
            filename=$(basename "$file")
            ln -sf "$file" "$TARGET_DIR/$filename" 2>/dev/null || cp "$file" "$TARGET_DIR/" 2>/dev/null || true
        fi
    done
fi

# å¤åˆ¶è®­ç»ƒå¥½çš„adapter
echo "ðŸ“¦ å¤åˆ¶è®­ç»ƒå¥½çš„adapter..."
cp "$SOURCE_ADAPTER/adapters.safetensors" "$TARGET_DIR/"
cp "$SOURCE_ADAPTER/adapter_config.json" "$TARGET_DIR/" 2>/dev/null || true

# åˆ›å»ºREADME
echo "ðŸ“ ç”ŸæˆREADME..."
cat > "$TARGET_DIR/README.md" << 'EOF'
# Qwen3-VL-30B åŒ»ç–—æ¨¡åž‹ V2 - ç²¾åº¦ä¼˜åŒ–ç‰ˆ

## ðŸŽ¯ æ¨¡åž‹ä¿¡æ¯
- **åŸºç¡€æ¨¡åž‹**: Qwen3-VL-30B-Medical-Finetuned
- **è®­ç»ƒç‰ˆæœ¬**: V2 - ç²¾åº¦ä¼˜åŒ–
- **è®­ç»ƒæ­¥æ•°**: 2000 steps
- **è®­ç»ƒæ—¥æœŸ**: 2025-12-05

## ðŸ“Š è®­ç»ƒç»“æžœ
- **æœ€ç»ˆéªŒè¯æŸå¤±**: 0.311
- **æœ€ç»ˆè®­ç»ƒæŸå¤±**: 0.379
- **LoRA Rank**: 128
- **å­¦ä¹ çŽ‡**: 5e-6

## ðŸŽ¯ è®­ç»ƒä¼˜å…ˆçº§
1. **ç²¾åº¦ (50%)** - åŒ»ç–—è¯Šæ–­å‡†ç¡®æ€§ç¬¬ä¸€
2. **äººæƒ…å‘³ (35%)** - æ¸©æš–å…³æ€€è¡¨è¾¾ç¬¬äºŒ
3. **å›¾åƒè¯†åˆ« (15%)** - å¤šæ¨¡æ€èƒ½åŠ›ç¬¬ä¸‰

## âœ¨ æ”¹è¿›ç‰¹ç‚¹
ç›¸æ¯”V1ç‰ˆæœ¬ï¼š
- âœ… åŒ»ç–—è¯Šæ–­å‡†ç¡®æ€§æ˜¾è‘—æå‡
- âœ… ä¿æŒæ¸©æš–äººæ€§åŒ–çš„è¡¨è¾¾
- âœ… å¢žå¼ºå›¾åƒç†è§£èƒ½åŠ›
- âœ… å‡å°‘æ­¦æ–­å’Œé”™è¯¯è¡¨è¾¾
- âœ… æ›´ç§‘å­¦çš„åŒ»ç–—å»ºè®®

## ðŸ“ˆ æ€§èƒ½å¯¹æ¯”
| æŒ‡æ ‡ | V1 | V2 (å½“å‰) | æå‡ |
|------|-----|-----------|------|
| è¯Šæ–­å‡†ç¡®æ€§ | â˜…â˜…â˜…â˜†â˜† | â˜…â˜…â˜…â˜…â˜… | â¬†ï¸â¬†ï¸ |
| äººæƒ…å‘³è¡¨è¾¾ | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜…â˜† | â¬‡ï¸ ç•¥é™ä½†ä»ä¼˜ç§€ |
| å›¾åƒè¯†åˆ« | â˜…â˜…â˜…â˜†â˜† | â˜…â˜…â˜…â˜…â˜† | â¬†ï¸ |

## ðŸš€ ä½¿ç”¨æ–¹æ³•
åœ¨LM Studioä¸­ï¼š
1. é€‰æ‹©æ­¤æ¨¡åž‹
2. åŠ è½½èŠå¤©ç•Œé¢
3. å¯ä»¥è¾“å…¥æ–‡æœ¬æˆ–ä¸Šä¼ åŒ»ç–—å›¾åƒ
4. èŽ·å¾—ä¸“ä¸šä¸”æ¸©æš–çš„åŒ»ç–—å»ºè®®

## âš ï¸ é‡è¦æç¤º
æœ¬æ¨¡åž‹ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—è¯Šæ–­ã€‚
å¦‚æœ‰ä¸¥é‡ç—‡çŠ¶ï¼Œè¯·åŠæ—¶å°±åŒ»ã€‚

## ðŸ“… ç‰ˆæœ¬åŽ†å²
- V2 (2025-12-05): ç²¾åº¦ä¼˜åŒ–è®­ç»ƒï¼Œ2000æ­¥
- V1 (2025-12-05): åˆå§‹ç‰ˆæœ¬ï¼Œ1000æ­¥
EOF

echo ""
echo "=================================================="
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "=================================================="
echo ""
echo "ðŸ“‚ æ¨¡åž‹ä½ç½®: $TARGET_DIR"
echo ""
echo "ðŸš€ åœ¨LM Studioä¸­ä½¿ç”¨ï¼š"
echo "   1. æ‰“å¼€LM Studio"
echo "   2. è¿›å…¥ 'æˆ‘çš„æ¨¡åž‹' æˆ– 'Local Models'"
echo "   3. æ‰¾åˆ°: Qwen3-VL-30B-Medical-V2-Accuracy"
echo "   4. ç‚¹å‡» 'Load Model' åŠ è½½"
echo "   5. å¼€å§‹èŠå¤©æµ‹è¯•ï¼"
echo ""
echo "ðŸ’¡ æ¨¡åž‹ç‰¹ç‚¹ï¼š"
echo "   - ç²¾åº¦ä¼˜å…ˆï¼ˆ50%æƒé‡ï¼‰"
echo "   - ä¿æŒäººæƒ…å‘³ï¼ˆ35%æƒé‡ï¼‰"
echo "   - æ”¯æŒå›¾åƒè¯†åˆ«ï¼ˆ15%æƒé‡ï¼‰"
echo ""
echo "=================================================="

