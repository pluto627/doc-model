#!/usr/bin/env python3
"""
ç”Ÿæˆè¯ç‰©ç›¸å…³çš„è®­ç»ƒæ•°æ®
è®©æ¨¡å‹å­¦ä¼šæä¾›å…·ä½“è¯ç‰©åç§°å’Œç”¨è¯æŒ‡å¯¼
"""

import json
import random
from pathlib import Path
from typing import List, Dict, Any
from drug_knowledge_base import DrugKnowledgeBase

from rich.console import Console
from rich.panel import Panel

console = Console()


class DrugTrainingDataGenerator:
    """è¯ç‰©è®­ç»ƒæ•°æ®ç”Ÿæˆå™¨"""
    
    def __init__(self):
        self.kb = DrugKnowledgeBase()
        self.generated_data = []
        
    def create_specific_disease_cases(self) -> List[Dict[str, Any]]:
        """
        åˆ›å»ºå…·ä½“ç–¾ç—…æ¡ˆä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä»ç±»åˆ«æ·±å…¥åˆ°å…·ä½“è¯ç‰©
        """
        cases = []
        
        # æ¡ˆä¾‹1ï¼šè¿‡æ•æ€§ç´«ç™œè½»åº¦
        cases.append({
            "id": "drug_case_hsp_mild_1",
            "messages": [
                {
                    "role": "user",
                    "content": [{"type": "text", "text": "æˆ‘ç°åœ¨æœ‰è¿‡æ•æ€§ç´«ç™œï¼Œè…¿ä¸Šæœ‰ä¸€äº›ç´«è‰²çš„å°ç‚¹ï¼Œä¸æ˜¯å¾ˆä¸¥é‡ï¼Œæˆ‘è¯¥åƒä»€ä¹ˆè¯ï¼Ÿ"}]
                },
                {
                    "role": "assistant",
                    "content": self._generate_response_for_mild_hsp()
                }
            ],
            "image_path": None,
            "source": "drug_knowledge_base",
            "metadata": {"condition": "è¿‡æ•æ€§ç´«ç™œ", "severity": "è½»åº¦"}
        })
        
        # æ¡ˆä¾‹2ï¼šè¿‡æ•æ€§ç´«ç™œä¸­åº¦ï¼ˆå…³èŠ‚ç—›ï¼‰
        cases.append({
            "id": "drug_case_hsp_moderate_1",
            "messages": [
                {
                    "role": "user",
                    "content": [{"type": "text", "text": "æˆ‘å°æ—¶å€™å¾—è¿‡è¿‡æ•æ€§ç´«ç™œï¼Œç°åœ¨åˆå¤å‘äº†ï¼Œä¸ä»…æœ‰çš®ç–¹ï¼Œå…³èŠ‚ä¹Ÿå¾ˆç–¼ï¼Œåº”è¯¥åƒä»€ä¹ˆè¯ï¼Ÿ"}]
                },
                {
                    "role": "assistant",
                    "content": self._generate_response_for_moderate_hsp_with_arthritis()
                }
            ],
            "image_path": None,
            "source": "drug_knowledge_base",
            "metadata": {"condition": "è¿‡æ•æ€§ç´«ç™œ", "severity": "ä¸­åº¦", "symptoms": ["çš®ç–¹", "å…³èŠ‚ç—›"]}
        })
        
        # æ¡ˆä¾‹3ï¼šè¿‡æ•æ€§ç´«ç™œé‡åº¦ï¼ˆè‚¾è„å—ç´¯ï¼‰
        cases.append({
            "id": "drug_case_hsp_severe_1",
            "messages": [
                {
                    "role": "user",
                    "content": [{"type": "text", "text": "æˆ‘çš„è¿‡æ•æ€§ç´«ç™œå¾ˆä¸¥é‡ï¼Œå°¿æ£€å‘ç°æœ‰è›‹ç™½å°¿å’Œè¡€å°¿ï¼ŒåŒ»ç”Ÿè¯´æ˜¯ç´«ç™œæ€§è‚¾ç‚ï¼Œéœ€è¦ç”¨ä»€ä¹ˆè¯ï¼Ÿ"}]
                },
                {
                    "role": "assistant",
                    "content": self._generate_response_for_severe_hsp_with_nephritis()
                }
            ],
            "image_path": None,
            "source": "drug_knowledge_base",
            "metadata": {"condition": "ç´«ç™œæ€§è‚¾ç‚", "severity": "é‡åº¦"}
        })
        
        # æ¡ˆä¾‹4ï¼šå…³èŠ‚ç‚ç–¼ç—›
        cases.append({
            "id": "drug_case_arthritis_1",
            "messages": [
                {
                    "role": "user",
                    "content": [{"type": "text", "text": "æˆ‘æœ‰å…³èŠ‚ç‚ï¼Œè†ç›–ç–¼å¾—å‰å®³ï¼ŒåŒ»ç”Ÿè¯´å¯ä»¥åƒéç”¾ä½“æŠ—ç‚è¯ï¼Œå…·ä½“åº”è¯¥åƒå“ªä¸€ç§ï¼Ÿ"}]
                },
                {
                    "role": "assistant",
                    "content": self._generate_response_for_arthritis()
                }
            ],
            "image_path": None,
            "source": "drug_knowledge_base",
            "metadata": {"condition": "å…³èŠ‚ç‚"}
        })
        
        # æ¡ˆä¾‹5ï¼šæ¿€ç´ å‡é‡æœŸ
        cases.append({
            "id": "drug_case_steroid_tapering_1",
            "messages": [
                {
                    "role": "user",
                    "content": [{"type": "text", "text": "æˆ‘å› ä¸ºç´«ç™œåœ¨åƒæ¿€ç´ ï¼ˆæ³¼å°¼æ¾ï¼‰ï¼Œç°åœ¨ç—…æƒ…ç¨³å®šäº†ï¼ŒåŒ»ç”Ÿè¯´è¦å‡é‡ï¼Œä½†åˆæ€•å¤å‘ï¼Œæœ‰ä»€ä¹ˆç»´æŒæ²»ç–—çš„è¯ç‰©å—ï¼Ÿ"}]
                },
                {
                    "role": "assistant",
                    "content": self._generate_response_for_maintenance_therapy()
                }
            ],
            "image_path": None,
            "source": "drug_knowledge_base",
            "metadata": {"condition": "æ¿€ç´ å‡é‡", "maintenance": True}
        })
        
        # æ¡ˆä¾‹6ï¼šè¯¢é—®å…·ä½“è¯ç‰©ä¿¡æ¯
        cases.append({
            "id": "drug_case_specific_drug_1",
            "messages": [
                {
                    "role": "user",
                    "content": [{"type": "text", "text": "åŒ»ç”Ÿç»™æˆ‘å¼€äº†ç¡«å”‘å˜Œå‘¤ï¼Œè¯´æ˜¯å…ç–«æŠ‘åˆ¶å‰‚ï¼Œæˆ‘æƒ³çŸ¥é“è¿™ä¸ªè¯è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"}]
                },
                {
                    "role": "assistant",
                    "content": self._generate_response_for_azathioprine_inquiry()
                }
            ],
            "image_path": None,
            "source": "drug_knowledge_base",
            "metadata": {"drug_inquiry": "ç¡«å”‘å˜Œå‘¤"}
        })
        
        # æ¡ˆä¾‹7ï¼šå¯¹æ¯”ä¸åŒè¯ç‰©
        cases.append({
            "id": "drug_case_comparison_1",
            "messages": [
                {
                    "role": "user",
                    "content": [{"type": "text", "text": "æˆ‘çœ‹åˆ°æ²»ç–—ç´«ç™œå¯ä»¥ç”¨æ³¼å°¼æ¾æˆ–ç”²æ³¼å°¼é¾™ï¼Œè¿™ä¸¤ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"}]
                },
                {
                    "role": "assistant",
                    "content": self._generate_response_for_steroid_comparison()
                }
            ],
            "image_path": None,
            "source": "drug_knowledge_base",
            "metadata": {"comparison": ["æ³¼å°¼æ¾", "ç”²æ³¼å°¼é¾™"]}
        })
        
        return cases
    
    def _generate_response_for_mild_hsp(self) -> str:
        """ç”Ÿæˆè½»åº¦è¿‡æ•æ€§ç´«ç™œçš„å›å¤"""
        antihistamine = self.kb.get_drugs_by_category("æŠ—ç»„èƒºè¯")[0]  # æ°¯é›·ä»–å®š
        vascular = self.kb.get_drugs_by_category("è¡€ç®¡ä¿æŠ¤å‰‚")[0]  # èŠ¦ä¸
        vit_c = self.kb.get_drugs_by_category("è¡€ç®¡ä¿æŠ¤å‰‚")[2]  # ç»´ç”Ÿç´ C
        
        response = (
            "æˆ‘ç†è§£æ‚¨çš„æ‹…å¿§ã€‚è¿‡æ•æ€§ç´«ç™œå¤å‘ç¡®å®è®©äººä¸å®‰ï¼Œä½†è¯·ä¸è¦è¿‡åº¦ç„¦è™‘ã€‚æ ¹æ®æ‚¨æè¿°çš„ç—‡çŠ¶ï¼ˆè…¿ä¸Šæœ‰ç´«è‰²å°ç‚¹ï¼Œç¨‹åº¦è¾ƒè½»ï¼‰ï¼Œ"
            "è¿™å±äºè½»åº¦è¿‡æ•æ€§ç´«ç™œï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è¯ç‰©è¿›è¡Œæ²»ç–—ï¼š\n\n"
            
            "## ğŸ’Š æ¨èç”¨è¯æ–¹æ¡ˆ\n\n"
            
            f"### 1. æŠ—è¿‡æ•æ²»ç–— - {antihistamine['name']}\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{antihistamine['dosage']}\n"
            f"- **ä½œç”¨**ï¼š{antihistamine['mechanism']}\n"
            f"- **ä¼˜ç‚¹**ï¼šæ— å—œç¡å‰¯ä½œç”¨ï¼Œä¸å½±å“æ—¥å¸¸å·¥ä½œå­¦ä¹ \n\n"
            
            f"**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š\n"
            f"- {antihistamine['precautions'][0]}\n"
            f"- {antihistamine['precautions'][2]}\n\n"
            
            f"### 2. è¡€ç®¡ä¿æŠ¤æ²»ç–— - {vascular['name']} + {vit_c['name']}\n"
            f"- **èŠ¦ä¸**ï¼š{vascular['dosage']}ï¼Œå¢å¼ºæ¯›ç»†è¡€ç®¡å£ï¼Œé™ä½è¡€ç®¡é€šé€æ€§\n"
            f"- **ç»´ç”Ÿç´ C**ï¼š{vit_c['dosage']}ï¼ŒååŒèŠ¦ä¸ä½œç”¨ï¼Œæ•ˆæœæ›´å¥½\n\n"
            
            f"**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š\n"
            f"- ä¸¤è¯åˆç”¨æ•ˆæœæ›´ä½³\n"
            f"- éœ€æŒç»­æœç”¨2-4å‘¨æ‰èƒ½è§æ•ˆ\n"
            f"- é¥­åæœç”¨ï¼Œå‡å°‘èƒƒéƒ¨ä¸é€‚\n\n"
            
            "## ğŸ¥ ç”Ÿæ´»ç®¡ç†å»ºè®®\n\n"
            "1. **ä¼‘æ¯**ï¼šé¿å…å‰§çƒˆè¿åŠ¨ï¼Œå‡å°‘ä¸‹è‚¢ç«™ç«‹æ—¶é—´\n"
            "2. **é¥®é£Ÿ**ï¼šé¿å…æµ·é²œã€ç‰›å¥¶ã€é¸¡è›‹ç­‰å¯èƒ½çš„è¿‡æ•é£Ÿç‰©\n"
            "3. **è§‚å¯Ÿ**ï¼šè®°å½•çš®ç–¹å˜åŒ–ï¼Œå¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µéœ€ç«‹å³å°±åŒ»ï¼š\n"
            "   - çš®ç–¹è¿…é€Ÿå¢å¤šæˆ–èåˆæˆç‰‡\n"
            "   - å‡ºç°è…¹ç—›ã€å…³èŠ‚ç—›\n"
            "   - å°¿æ¶²é¢œè‰²æ”¹å˜ï¼ˆè¡€å°¿ï¼‰\n\n"
            
            "## ğŸ“‹ å¤æŸ¥å»ºè®®\n\n"
            "- **1å‘¨å**ï¼šè§‚å¯Ÿçš®ç–¹æ˜¯å¦æ¶ˆé€€\n"
            "- **2å‘¨å**ï¼šå¤æŸ¥å°¿å¸¸è§„ï¼Œæ’é™¤è‚¾è„å—ç´¯\n"
            "- **4å‘¨å**ï¼šå¦‚æœç—‡çŠ¶æœªæ”¹å–„ï¼Œéœ€è°ƒæ•´æ²»ç–—æ–¹æ¡ˆ\n\n"
            
            "è¯·è®°ä½ï¼Œè¿™äº›è¯ç‰©å»ºè®®ä»…ä¾›å‚è€ƒï¼Œ**æœ€å¥½åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ä½¿ç”¨**ã€‚å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–ç–‘é—®ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚ç¥æ‚¨æ—©æ—¥åº·å¤ï¼ğŸŒ¸"
        )
        
        return response
    
    def _generate_response_for_moderate_hsp_with_arthritis(self) -> str:
        """ç”Ÿæˆä¸­åº¦è¿‡æ•æ€§ç´«ç™œä¼´å…³èŠ‚ç—›çš„å›å¤"""
        nsaid = self.kb.get_drugs_by_category("éç”¾ä½“æŠ—ç‚è¯")[0]  # å¸ƒæ´›èŠ¬
        alternative_nsaid = self.kb.get_drugs_by_category("éç”¾ä½“æŠ—ç‚è¯")[1]  # å¡æ¥æ˜”å¸ƒ
        antihistamine = self.kb.get_drugs_by_category("æŠ—ç»„èƒºè¯")[1]  # è¥¿æ›¿åˆ©å—ª
        
        response = (
            "æ„Ÿè°¢æ‚¨ä¿¡ä»»æˆ‘å¹¶åˆ†äº«æ‚¨çš„ç—…å²ã€‚è¿‡æ•æ€§ç´«ç™œå¤å‘ä¸”ä¼´æœ‰å…³èŠ‚ç—›ï¼Œç¡®å®éœ€è¦æ›´ç§¯æçš„æ²»ç–—ã€‚"
            "æˆ‘ç†è§£æ‚¨çš„æ‹…å¿§ï¼Œä½†è¯·æ”¾å¿ƒï¼Œè¿™ç§æƒ…å†µæ˜¯å¯ä»¥é€šè¿‡è§„èŒƒæ²»ç–—å¾—åˆ°æ§åˆ¶çš„ã€‚\n\n"
            
            "## ğŸ’Š æ¨èç”¨è¯æ–¹æ¡ˆ\n\n"
            
            f"### 1. æŠ—ç‚é•‡ç—›æ²»ç–—ï¼ˆé¦–é€‰ï¼‰\n\n"
            f"**æ–¹æ¡ˆAï¼š{nsaid['name']}ï¼ˆå¸ƒæ´›èŠ¬ï¼‰**\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{nsaid['dosage']}\n"
            f"- **ä½œç”¨**ï¼šæ—¢èƒ½ç¼“è§£å…³èŠ‚ç–¼ç—›ï¼Œåˆèƒ½æ§åˆ¶ç‚ç—‡ååº”\n"
            f"- **ä¼˜ç‚¹**ï¼šå®‰å…¨æ€§å¥½ï¼Œä»·æ ¼ä¾¿å®œï¼Œè¯åº—å¯è´­ä¹°\n\n"
            
            f"**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**ï¼š\n"
        )
        
        for precaution in nsaid['precautions'][:4]:
            response += f"- {precaution}\n"
        
        response += (
            f"\n**æ–¹æ¡ˆBï¼š{alternative_nsaid['name']}ï¼ˆå¡æ¥æ˜”å¸ƒï¼‰** - é€‚åˆæœ‰èƒƒç—…å²çš„æ‚£è€…\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{alternative_nsaid['dosage']}\n"
            f"- **ä¼˜ç‚¹**ï¼šé€‰æ‹©æ€§COX-2æŠ‘åˆ¶å‰‚ï¼Œèƒƒè‚ é“å‰¯ä½œç”¨æ›´å°\n"
            f"- **æ³¨æ„**ï¼š{alternative_nsaid['precautions'][0]}\n\n"
            
            f"### 2. æŠ—è¿‡æ•æ²»ç–— - {antihistamine['name']}\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{antihistamine['dosage']}\n"
            f"- **å»ºè®®**ï¼šæ™šä¸Šç¡å‰æœç”¨ï¼Œå¯èƒ½æœ‰è½»å¾®å—œç¡ä½œç”¨\n\n"
            
            "### 3. è¡€ç®¡ä¿æŠ¤æ²»ç–—\n"
            "- **èŠ¦ä¸ç‰‡**ï¼šæ¯æ¬¡20mgï¼Œæ¯æ—¥3æ¬¡\n"
            "- **ç»´ç”Ÿç´ C**ï¼šæ¯æ—¥100-200mg\n\n"
            
            "## ğŸ¥ ç—…æƒ…ç›‘æµ‹ï¼ˆé‡è¦ï¼ï¼‰\n\n"
            "ç”±äºæ‚¨æœ‰å…³èŠ‚ç—‡çŠ¶ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æƒ…å†µï¼š\n\n"
            
            "**âš ï¸ ç«‹å³å°±åŒ»æŒ‡å¾**ï¼š\n"
            "1. **è…¹ç—›**ï¼šå°¤å…¶æ˜¯å‰§çƒˆç»ç—›ã€å‘•åã€ä¾¿è¡€\n"
            "2. **å°¿æ¶²å¼‚å¸¸**ï¼šè‚‰çœ¼è¡€å°¿ã€å°¿é‡å‡å°‘ã€æ³¡æ²«å°¿\n"
            "3. **çš®ç–¹åŠ é‡**ï¼šå¤§ç‰‡èåˆã€åæ­»æ€§ç´«ç™œ\n"
            "4. **å…³èŠ‚çº¢è‚¿çƒ­ç—›åŠ é‡**\n\n"
            
            "**å»ºè®®æ£€æŸ¥**ï¼š\n"
            "- å°¿å¸¸è§„ï¼ˆæœ€é‡è¦ï¼æ¯å‘¨å¤æŸ¥ï¼‰\n"
            "- è¡€å¸¸è§„ã€è‚è‚¾åŠŸèƒ½\n"
            "- å‡è¡€åŠŸèƒ½\n"
            "- å…ç–«æŒ‡æ ‡ï¼ˆè¡¥ä½“ã€å…ç–«çƒè›‹ç™½ï¼‰\n\n"
            
            "## ğŸ’¡ ç‰¹æ®Šæé†’\n\n"
            "å¦‚æœä½¿ç”¨å¸ƒæ´›èŠ¬ç­‰éç”¾ä½“æŠ—ç‚è¯**3-5å¤©åç—‡çŠ¶æ— æ˜æ˜¾æ”¹å–„**ï¼Œæˆ–è€…å‡ºç°ä»¥ä¸‹æƒ…å†µï¼š\n"
            "- å…³èŠ‚æŒç»­è‚¿èƒ€ç–¼ç—›\n"
            "- çš®ç–¹æŒç»­æ–°å‘\n"
            "- å°¿æ£€å¼‚å¸¸\n\n"
            
            "**éœ€è¦è€ƒè™‘å‡çº§æ²»ç–—æ–¹æ¡ˆ**ï¼Œå¯èƒ½éœ€è¦åŠ ç”¨ï¼š\n"
            "- å°å‰‚é‡ç³–çš®è´¨æ¿€ç´ ï¼ˆå¦‚æ³¼å°¼æ¾0.5mg/kg/å¤©ï¼‰\n"
            "- å¿…é¡»åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ä½¿ç”¨\n\n"
            
            "## ğŸŒŸ ç”Ÿæ´»å»ºè®®\n\n"
            "1. **å§åºŠä¼‘æ¯**ï¼šå…³èŠ‚ç—›æœŸé—´é¿å…è´Ÿé‡å’Œå‰§çƒˆæ´»åŠ¨\n"
            "2. **é¥®é£Ÿæ¸…æ·¡**ï¼šé¿å…å·²çŸ¥è¿‡æ•é£Ÿç‰©\n"
            "3. **ä¿æš–**ï¼šå…³èŠ‚éƒ¨ä½æ³¨æ„ä¿æš–\n"
            "4. **é¢„é˜²æ„ŸæŸ“**ï¼šé¿å…æ„Ÿå†’ï¼Œå› ä¸ºæ„ŸæŸ“ä¼šåŠ é‡ç—…æƒ…\n\n"
            
            "è¯·è®°ä½ï¼Œä¸­åº¦ç´«ç™œéœ€è¦è§„èŒƒæ²»ç–—å’Œå¯†åˆ‡éšè®¿ã€‚å»ºè®®æ‚¨å°½å¿«åˆ°é£æ¹¿å…ç–«ç§‘å°±è¯Šï¼Œåˆ¶å®šä¸ªæ€§åŒ–æ²»ç–—æ–¹æ¡ˆã€‚"
            "å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ã€‚ç¥æ‚¨æ—©æ—¥åº·å¤ï¼ğŸ’ª"
        )
        
        return response
    
    def _generate_response_for_severe_hsp_with_nephritis(self) -> str:
        """ç”Ÿæˆé‡åº¦ç´«ç™œæ€§è‚¾ç‚çš„å›å¤"""
        steroid = self.kb.get_drugs_by_category("ç³–çš®è´¨æ¿€ç´ ")[0]  # æ³¼å°¼æ¾
        steroid_pulse = self.kb.get_drugs_by_category("ç³–çš®è´¨æ¿€ç´ ")[1]  # ç”²æ³¼å°¼é¾™
        immunosuppressant = self.kb.get_drugs_by_category("å…ç–«è°ƒèŠ‚å‰‚")[0]  # ç¡«å”‘å˜Œå‘¤
        alternative_immune = self.kb.get_drugs_by_category("å…ç–«è°ƒèŠ‚å‰‚")[2]  # éœ‰é…šé…¸é…¯
        
        response = (
            "æˆ‘æ·±æ·±ç†è§£æ‚¨æ­¤åˆ»çš„æ‹…å¿§å’Œææƒ§ã€‚ç´«ç™œæ€§è‚¾ç‚æ˜¯è¿‡æ•æ€§ç´«ç™œè¾ƒä¸ºä¸¥é‡çš„å¹¶å‘ç—‡ï¼Œä½†è¯·æ‚¨ä¸è¦è¿‡åº¦ææ…Œï¼Œ"
            "è¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ²»ç–—å’Œæ§åˆ¶çš„ç–¾ç—…ã€‚å…³é”®æ˜¯è¦åŠæ—¶è§„èŒƒæ²»ç–—ï¼Œå¯†åˆ‡éšè®¿ã€‚\n\n"
            
            "## âš ï¸ é‡è¦æé†’\n\n"
            "**ç´«ç™œæ€§è‚¾ç‚å¿…é¡»åœ¨ä¸“ç§‘åŒ»ç”Ÿï¼ˆè‚¾å†…ç§‘æˆ–é£æ¹¿å…ç–«ç§‘ï¼‰æŒ‡å¯¼ä¸‹æ²»ç–—ï¼Œåˆ‡å‹¿è‡ªè¡Œç”¨è¯ï¼**\n"
            "ä»¥ä¸‹ä¿¡æ¯ä»…ä¾›æ‚¨äº†è§£å¯èƒ½çš„æ²»ç–—æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°ä¸åŒ»ç”Ÿæ²Ÿé€šã€‚\n\n"
            
            "## ğŸ’Š æ ‡å‡†æ²»ç–—æ–¹æ¡ˆ\n\n"
            
            "### ğŸ”´ ç¬¬ä¸€é˜¶æ®µï¼šè¯±å¯¼ç¼“è§£æ²»ç–—ï¼ˆæ§åˆ¶æ€¥æ€§ç‚ç—‡ï¼‰\n\n"
            
            f"#### 1. ç³–çš®è´¨æ¿€ç´ æ²»ç–—\n\n"
            f"**å£æœæ–¹æ¡ˆ - {steroid['name']}**\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{steroid['dosage']}\n"
            f"- **ç–—ç¨‹**ï¼šé€šå¸¸éœ€è¦æŒç»­4-8å‘¨ï¼Œç„¶åé€æ¸å‡é‡\n"
            f"- **ä½œç”¨**ï¼šå¿«é€Ÿæ§åˆ¶å…ç–«ç‚ç—‡ååº”ï¼Œå‡è½»è‚¾è„æŸä¼¤\n\n"
            
            f"**âš ï¸ æ¿€ç´ ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼ˆéå¸¸é‡è¦ï¼ï¼‰**ï¼š\n"
        )
        
        for i, precaution in enumerate(steroid['precautions'], 1):
            response += f"{i}. {precaution}\n"
        
        response += (
            f"\n**å†²å‡»æ²»ç–—æ–¹æ¡ˆ - {steroid_pulse['name']}** ï¼ˆç”¨äºé‡ç—‡æ‚£è€…ï¼‰\n"
            f"- **ç”¨æ³•**ï¼š{steroid_pulse['dosage']}\n"
            f"- **é€‚åº”ç—‡**ï¼šå°¿è›‹ç™½å¤§é‡ï¼ˆ>3.5g/24hï¼‰ã€è‚¾åŠŸèƒ½å¿«é€Ÿæ¶åŒ–\n"
            f"- **å¿…é¡»ä½é™¢æ²»ç–—**\n\n"
            
            f"#### 2. å…ç–«æŠ‘åˆ¶å‰‚æ²»ç–—\n\n"
            "æ ¹æ®è‚¾è„ç—…ç†ç±»å‹å’Œä¸¥é‡ç¨‹åº¦ï¼Œå¯èƒ½éœ€è¦è”åˆå…ç–«æŠ‘åˆ¶å‰‚ï¼š\n\n"
            
            f"**æ–¹æ¡ˆAï¼š{immunosuppressant['name']}**\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{immunosuppressant['dosage']}\n"
            f"- **ä¼˜ç‚¹**ï¼šç»å…¸å…ç–«æŠ‘åˆ¶å‰‚ï¼Œç»éªŒä¸°å¯Œï¼Œä»·æ ¼ä¾¿å®œ\n"
            f"- **èµ·æ•ˆæ—¶é—´**ï¼šéœ€è¦8-12å‘¨\n\n"
            
            f"**âš ï¸ ç¡«å”‘å˜Œå‘¤æ³¨æ„äº‹é¡¹**ï¼š\n"
        )
        
        for precaution in immunosuppressant['precautions']:
            response += f"- {precaution}\n"
        
        response += (
            f"\n**æ–¹æ¡ˆBï¼š{alternative_immune['name']}**\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{alternative_immune['dosage']}\n"
            f"- **ä¼˜ç‚¹**ï¼šç–—æ•ˆæ›´å¥½ï¼Œå°¤å…¶é€‚åˆæ¿€ç´ æŠµæŠ—æˆ–æ¿€ç´ ä¾èµ–çš„æ‚£è€…\n"
            f"- **ç¼ºç‚¹**ï¼šä»·æ ¼è¾ƒè´µï¼Œå¯èƒ½å¼•èµ·è…¹æ³»\n\n"
            
            f"**âš ï¸ éœ‰é…šé…¸é…¯æ³¨æ„äº‹é¡¹**ï¼š\n"
        )
        
        for precaution in alternative_immune['precautions']:
            response += f"- {precaution}\n"
        
        response += (
            "\n### ğŸŸ¡ ç¬¬äºŒé˜¶æ®µï¼šç»´æŒç¼“è§£æ²»ç–—ï¼ˆé•¿æœŸæ§åˆ¶ï¼‰\n\n"
            "å½“ç—…æƒ…å¾—åˆ°æ§åˆ¶åï¼ˆå°¿è›‹ç™½è½¬é˜´æˆ–æ˜æ˜¾å‡å°‘ï¼‰ï¼Œè¿›å…¥ç»´æŒæ²»ç–—é˜¶æ®µï¼š\n\n"
            "1. **æ¿€ç´ ç¼“æ…¢å‡é‡**ï¼šæ¯1-2å‘¨å‡å°‘5-10mgï¼Œç›´è‡³å°å‰‚é‡ç»´æŒï¼ˆ5-10mg/å¤©ï¼‰\n"
            "2. **ç»§ç»­å…ç–«æŠ‘åˆ¶å‰‚**ï¼šç»´æŒæ²»ç–—6-12ä¸ªæœˆç”šè‡³æ›´é•¿\n"
            "3. **å®šæœŸå¤æŸ¥**ï¼šæ¯2-4å‘¨å¤æŸ¥å°¿å¸¸è§„ã€è‚¾åŠŸèƒ½\n\n"
            
            "## ğŸ¥ å¿…é¡»è¿›è¡Œçš„æ£€æŸ¥å’Œç›‘æµ‹\n\n"
            "### åŸºç¡€æ£€æŸ¥ï¼ˆæ²»ç–—å‰å¿…åšï¼‰\n"
            "- 24å°æ—¶å°¿è›‹ç™½å®šé‡\n"
            "- å°¿å¸¸è§„ã€å°¿çº¢ç»†èƒå½¢æ€\n"
            "- è‚¾åŠŸèƒ½ï¼ˆè‚Œé…ã€å°¿ç´ æ°®ã€å°¿é…¸ï¼‰\n"
            "- è¡€å¸¸è§„ã€è‚åŠŸèƒ½\n"
            "- å…ç–«æŒ‡æ ‡ï¼ˆè¡¥ä½“C3ã€C4ã€IgAã€IgGã€IgMï¼‰\n"
            "- è‡ªèº«æŠ—ä½“ï¼ˆANCAã€ANAï¼‰\n"
            "- **è‚¾ç©¿åˆºæ´»æ£€**ï¼ˆæ ¹æ®æƒ…å†µå†³å®šï¼Œæ˜ç¡®ç—…ç†ç±»å‹ï¼‰\n\n"
            
            "### æ²»ç–—æœŸé—´å®šæœŸç›‘æµ‹ï¼ˆé‡è¦ï¼ï¼‰\n"
            "- **æ¯å‘¨**ï¼šå°¿å¸¸è§„\n"
            "- **æ¯2å‘¨**ï¼šè¡€å¸¸è§„ã€è‚è‚¾åŠŸèƒ½ï¼ˆä½¿ç”¨å…ç–«æŠ‘åˆ¶å‰‚æœŸé—´ï¼‰\n"
            "- **æ¯æœˆ**ï¼š24å°æ—¶å°¿è›‹ç™½å®šé‡\n"
            "- **æ¯3æœˆ**ï¼šå…ç–«æŒ‡æ ‡ã€è¡€ç³–ã€è¡€è„‚ã€éª¨å¯†åº¦\n\n"
            
            "## ğŸš¨ ç´§æ€¥å°±åŒ»æŒ‡å¾\n\n"
            "å‡ºç°ä»¥ä¸‹æƒ…å†µéœ€ç«‹å³å°±åŒ»ï¼š\n"
            "1. è‚‰çœ¼è¡€å°¿ï¼ˆå°¿æ¶²å‘ˆæ´—è‚‰æ°´æ ·æˆ–çº¢è‰²ï¼‰\n"
            "2. å°¿é‡æ˜æ˜¾å‡å°‘ï¼ˆ<400ml/24hï¼‰\n"
            "3. ä¸¥é‡æ°´è‚¿ï¼ˆå…¨èº«æ€§æ°´è‚¿ï¼‰\n"
            "4. è¡€å‹æ€¥å‰§å‡é«˜ï¼ˆ>180/110mmHgï¼‰\n"
            "5. å‘çƒ­ã€ä¸¥é‡æ„ŸæŸ“\n"
            "6. æ¶å¿ƒå‘•åã€é£Ÿæ¬²ä¸æŒ¯æŒç»­åŠ é‡\n\n"
            
            "## ğŸ’¡ ç”Ÿæ´»ç®¡ç†å»ºè®®\n\n"
            "1. **ä¼‘æ¯**ï¼šæ€¥æ€§æœŸå§åºŠä¼‘æ¯ï¼Œé¿å…åŠ³ç´¯\n"
            "2. **é¥®é£Ÿ**ï¼š\n"
            "   - ä½ç›é¥®é£Ÿï¼ˆæ¯æ—¥<6gï¼Œæ°´è‚¿æ—¶<3gï¼‰\n"
            "   - ä¼˜è´¨ä½è›‹ç™½é¥®é£Ÿï¼ˆ0.8g/kg/å¤©ï¼‰\n"
            "   - é¿å…å·²çŸ¥è¿‡æ•é£Ÿç‰©\n"
            "3. **æ„ŸæŸ“é¢„é˜²**ï¼š\n"
            "   - æ³¨æ„ä¸ªäººå«ç”Ÿ\n"
            "   - é¿å…åˆ°äººå¤šæ‹¥æŒ¤åœºæ‰€\n"
            "   - åŠæ—¶æ²»ç–—æ„Ÿå†’\n"
            "4. **å¿ƒç†è°ƒé€‚**ï¼šä¿æŒä¹è§‚å¿ƒæ€ï¼Œé¿å…è¿‡åº¦ç„¦è™‘\n\n"
            
            "## ğŸ“Š é¢„åè¯´æ˜\n\n"
            "ç´«ç™œæ€§è‚¾ç‚çš„é¢„åå–å†³äºå¤šç§å› ç´ ï¼š\n"
            "- **è½»åº¦ï¼ˆé•œä¸‹è¡€å°¿ã€å¾®é‡è›‹ç™½å°¿ï¼‰**ï¼šé¢„åè‰¯å¥½ï¼Œå¤šæ•°å¯å®Œå…¨æ¢å¤\n"
            "- **ä¸­åº¦ï¼ˆæŒç»­è›‹ç™½å°¿<1g/å¤©ï¼‰**ï¼šè§„èŒƒæ²»ç–—åå¤§éƒ¨åˆ†å¯æ§åˆ¶\n"
            "- **é‡åº¦ï¼ˆå¤§é‡è›‹ç™½å°¿ã€è‚¾åŠŸèƒ½å—æŸï¼‰**ï¼šéœ€è¦ç§¯ææ²»ç–—ï¼Œéƒ¨åˆ†æ‚£è€…å¯èƒ½è¿›å±•ä¸ºæ…¢æ€§è‚¾ç—…\n\n"
            "**å…³é”®æ˜¯æ—©å‘ç°ã€æ—©æ²»ç–—ã€è§„èŒƒæ²»ç–—ã€é•¿æœŸéšè®¿ï¼**\n\n"
            
            "## ğŸŒŸ æœ€åçš„è¯\n\n"
            "æˆ‘çŸ¥é“æ‚¨ç°åœ¨å¯èƒ½å¾ˆæ‹…å¿ƒï¼Œä½†è¯·ç›¸ä¿¡ï¼Œç´«ç™œæ€§è‚¾ç‚æ˜¯å¯ä»¥æ²»ç–—çš„ã€‚è®¸å¤šæ‚£è€…é€šè¿‡è§„èŒƒæ²»ç–—éƒ½è·å¾—äº†å¾ˆå¥½çš„é¢„åã€‚\n\n"
            
            "**è¯·åŠ¡å¿…å°½å¿«åˆ°æ­£è§„åŒ»é™¢è‚¾å†…ç§‘æˆ–é£æ¹¿å…ç–«ç§‘å°±è¯Šï¼Œåœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹åˆ¶å®šä¸ªä½“åŒ–æ²»ç–—æ–¹æ¡ˆã€‚**\n\n"
            
            "å¦‚æœæ‚¨è¿˜æœ‰ä»»ä½•ç–‘é—®ï¼Œæˆ–è€…åœ¨æ²»ç–—è¿‡ç¨‹ä¸­é‡åˆ°å›°æƒ‘ï¼Œéšæ—¶å¯ä»¥æ¥å’¨è¯¢æˆ‘ã€‚\n\n"
            "ç¥æ‚¨æ—©æ—¥åº·å¤ï¼ŒåŠ æ²¹ï¼ğŸ’ªğŸŒ¸"
        )
        
        return response
    
    def _generate_response_for_arthritis(self) -> str:
        """ç”Ÿæˆå…³èŠ‚ç‚ç”¨è¯å›å¤"""
        nsaids = self.kb.get_drugs_by_category("éç”¾ä½“æŠ—ç‚è¯")
        
        response = (
            "æˆ‘ç†è§£å…³èŠ‚ç–¼ç—›ç»™æ‚¨å¸¦æ¥çš„å›°æ‰°ã€‚éç”¾ä½“æŠ—ç‚è¯(NSAIDs)ç¡®å®æ˜¯æ²»ç–—å…³èŠ‚ç‚ç–¼ç—›çš„å¸¸ç”¨è¯ç‰©ã€‚"
            "è®©æˆ‘ä¸ºæ‚¨ä»‹ç»å‡ ç§å¸¸ç”¨çš„é€‰æ‹©ï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µé€‰æ‹©ï¼š\n\n"
            
            "## ğŸ’Š å¸¸ç”¨éç”¾ä½“æŠ—ç‚è¯å¯¹æ¯”\n\n"
        )
        
        for i, drug in enumerate(nsaids[:3], 1):
            response += (
                f"### {i}. {drug['name']}ï¼ˆ{drug['generic_name']}ï¼‰\n\n"
                f"**ç”¨æ³•ç”¨é‡**ï¼š{drug['dosage']}\n\n"
                f"**ç‰¹ç‚¹**ï¼š{drug['mechanism']}\n\n"
                f"**é€‚åˆäººç¾¤**ï¼š{drug['indications'][0]}\n\n"
                f"**æ³¨æ„äº‹é¡¹**ï¼š\n"
            )
            for precaution in drug['precautions'][:3]:
                response += f"- {precaution}\n"
            response += "\n"
        
        response += (
            "## ğŸ¤” å¦‚ä½•é€‰æ‹©ï¼Ÿ\n\n"
            "1. **æ™®é€šæ‚£è€…é¦–é€‰**ï¼šå¸ƒæ´›èŠ¬ - å®‰å…¨æ€§å¥½ï¼Œä»·æ ¼ä¾¿å®œï¼Œè¯åº—å¯ä¹°\n"
            "2. **æœ‰èƒƒç—…å²**ï¼šå¡æ¥æ˜”å¸ƒ - èƒƒè‚ é“å‰¯ä½œç”¨å°\n"
            "3. **ç–¼ç—›ä¸¥é‡**ï¼šå²å“šç¾è¾› - é•‡ç—›æ•ˆæœå¼ºï¼Œä½†å‰¯ä½œç”¨ç›¸å¯¹è¾ƒå¤§\n\n"
            
            "## âš ï¸ ä½¿ç”¨NSAIDsçš„é‡è¦æé†’\n\n"
            "1. **é¥­åæœç”¨**ï¼šå‡å°‘èƒƒè‚ é“åˆºæ¿€\n"
            "2. **çŸ­æœŸä½¿ç”¨**ï¼šä¸€èˆ¬ä¸è¶…è¿‡7-10å¤©ï¼Œé•¿æœŸéœ€åŒ»ç”Ÿç›‘ç£\n"
            "3. **é…åˆèƒƒä¿æŠ¤**ï¼šå¦‚æœ‰èƒƒéƒ¨ä¸é€‚ï¼Œå¯åŠ æœå¥¥ç¾æ‹‰å”‘ç­‰èƒƒè¯\n"
            "4. **é¿å…è”ç”¨**ï¼šä¸è¦åŒæ—¶åƒä¸¤ç§NSAIDs\n"
            "5. **è€å¹´äººæ…ç”¨**ï¼šä»å°å‰‚é‡å¼€å§‹\n\n"
            
            "## ğŸ¥ å°±åŒ»å»ºè®®\n\n"
            "å¦‚æœå…³èŠ‚ç–¼ç—›æŒç»­æˆ–åŠ é‡ï¼Œå»ºè®®æ‚¨åˆ°éª¨ç§‘æˆ–é£æ¹¿å…ç–«ç§‘å°±è¯Šï¼Œè¿›ä¸€æ­¥æ˜ç¡®è¯Šæ–­ã€‚"
            "æœ‰äº›å…³èŠ‚ç‚ï¼ˆå¦‚ç±»é£æ¹¿å…³èŠ‚ç‚ï¼‰éœ€è¦ä½¿ç”¨ç–¾ç—…ä¿®é¥°æŠ—é£æ¹¿è¯(DMARDs)æ‰èƒ½æ§åˆ¶ç—…æƒ…ã€‚\n\n"
            
            "å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–ç–‘é—®ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚ç¥æ‚¨æ—©æ—¥åº·å¤ï¼"
        )
        
        return response
    
    def _generate_response_for_maintenance_therapy(self) -> str:
        """ç”Ÿæˆç»´æŒæ²»ç–—çš„å›å¤"""
        immunosuppressants = self.kb.get_drugs_by_category("å…ç–«è°ƒèŠ‚å‰‚")
        chinese_med = self.kb.get_drugs_by_category("ä¸­æˆè¯")[1]  # å¤æ–¹ç”˜è‰é…¸è‹·
        
        response = (
            "æ‚¨æå‡ºäº†ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼æ¿€ç´ å‡é‡æœŸç¡®å®æ˜¯æ²»ç–—çš„å…³é”®é˜¶æ®µï¼Œå¾ˆå¤šæ‚£è€…åœ¨è¿™ä¸ªæ—¶æœŸå®¹æ˜“å¤å‘ã€‚"
            "ä½¿ç”¨å…ç–«è°ƒèŠ‚å‰‚è¿›è¡Œç»´æŒæ²»ç–—æ˜¯æ­£ç¡®çš„ç­–ç•¥ã€‚\n\n"
            
            "## ğŸ’Š æ¿€ç´ å‡é‡æœŸç»´æŒæ²»ç–—æ–¹æ¡ˆ\n\n"
            
            "### ä¸ºä»€ä¹ˆéœ€è¦ç»´æŒæ²»ç–—ï¼Ÿ\n\n"
            "1. **é¢„é˜²å¤å‘**ï¼šæ¿€ç´ å‡é‡åå…ç–«æŠ‘åˆ¶ä½œç”¨å‡å¼±ï¼Œå®¹æ˜“å¤å‘\n"
            "2. **å‡å°‘æ¿€ç´ ç”¨é‡**ï¼šä½¿ç”¨å…ç–«è°ƒèŠ‚å‰‚å¯ä»¥æ›´å¿«åœ°å‡åœæ¿€ç´ \n"
            "3. **é•¿æœŸæ§åˆ¶**ï¼šç»´æŒç—…æƒ…ç¨³å®šï¼Œä¿æŠ¤è‚¾è„åŠŸèƒ½\n\n"
            
            "### å¸¸ç”¨ç»´æŒæ²»ç–—è¯ç‰©\n\n"
            
            f"#### 1. {immunosuppressants[0]['name']}ï¼ˆé¦–é€‰ï¼Œæœ€å¸¸ç”¨ï¼‰\n\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{immunosuppressants[0]['dosage']}\n"
            f"- **ä¼˜ç‚¹**ï¼šç»éªŒä¸°å¯Œï¼Œä»·æ ¼ä¾¿å®œï¼Œç–—æ•ˆç¡®åˆ‡\n"
            f"- **ç¼ºç‚¹**ï¼šèµ·æ•ˆè¾ƒæ…¢ï¼ˆéœ€8-12å‘¨ï¼‰ï¼Œéœ€å®šæœŸå¤æŸ¥è¡€å¸¸è§„\n\n"
            
            f"**âš ï¸ ä½¿ç”¨ç¡«å”‘å˜Œå‘¤çš„æ³¨æ„äº‹é¡¹**ï¼š\n"
        )
        
        for precaution in immunosuppressants[0]['precautions']:
            response += f"- {precaution}\n"
        
        response += (
            f"\n#### 2. {immunosuppressants[2]['name']}ï¼ˆæ–°ä¸€ä»£å…ç–«æŠ‘åˆ¶å‰‚ï¼‰\n\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{immunosuppressants[2]['dosage']}\n"
            f"- **ä¼˜ç‚¹**ï¼šç–—æ•ˆå¥½ï¼Œç‰¹åˆ«é€‚åˆæ¿€ç´ ä¾èµ–å‹æ‚£è€…\n"
            f"- **ç¼ºç‚¹**ï¼šä»·æ ¼è¾ƒè´µï¼Œå¯èƒ½å¼•èµ·è…¹æ³»\n\n"
            
            f"#### 3. {immunosuppressants[3]['name']}ï¼ˆå°å‰‚é‡æ–¹æ¡ˆï¼‰\n\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{immunosuppressants[3]['dosage']}\n"
            f"- **ç‰¹åˆ«æ³¨æ„**ï¼šâš ï¸ æ¯å‘¨æœç”¨ä¸€æ¬¡ï¼Œä¸æ˜¯æ¯å¤©ï¼\n"
            f"- **å¿…é¡»åŒæ—¶è¡¥å……å¶é…¸**ï¼šæ¯å‘¨5mgï¼Œé”™å¼€æœè¯æ—¥\n\n"
            
            f"#### 4. è¾…åŠ©ç”¨è¯ - {chinese_med['name']}\n\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{chinese_med['dosage']}\n"
            f"- **ä½œç”¨**ï¼š{chinese_med['mechanism']}\n"
            f"- **ä¼˜ç‚¹**ï¼šå¯ä½œä¸ºæ¿€ç´ å‡é‡æ—¶çš„è¿‡æ¸¡ç”¨è¯ï¼Œå‡è½»æ¿€ç´ å‰¯ä½œç”¨\n"
            f"- **æ³¨æ„**ï¼š{chinese_med['precautions'][0]}\n\n"
            
            "## ğŸ“‹ æ¿€ç´ å‡é‡æ–¹æ¡ˆå‚è€ƒ\n\n"
            "å‡è®¾æ‚¨ç›®å‰æ³¼å°¼æ¾ç”¨é‡30mg/å¤©ï¼š\n\n"
            "1. **30mg â†’ 25mg**ï¼šç¨³å®š2å‘¨\n"
            "2. **25mg â†’ 20mg**ï¼šç¨³å®š2å‘¨\n"
            "3. **20mg â†’ 15mg**ï¼šç¨³å®š2å‘¨\n"
            "4. **15mg â†’ 10mg**ï¼šç¨³å®š2-4å‘¨ï¼ˆå…³é”®æœŸï¼‰\n"
            "5. **10mg â†’ 5mg**ï¼šæ¯æ¬¡å‡2.5mgï¼Œé—´éš”4å‘¨\n"
            "6. **5mg â†’ åœè¯**ï¼šéå¸¸ç¼“æ…¢ï¼Œå¯èƒ½éœ€è¦2-3ä¸ªæœˆ\n\n"
            
            "**âš ï¸ å‡é‡åŸåˆ™**ï¼š\n"
            "- ç—…æƒ…ç¨³å®šï¼ˆæ— æ–°å‘çš®ç–¹ã€å°¿å¸¸è§„æ­£å¸¸ï¼‰æ‰èƒ½å‡é‡\n"
            "- å‡é‡ä¸å®œè¿‡å¿«ï¼Œæ¬²é€Ÿåˆ™ä¸è¾¾\n"
            "- 10mgä»¥ä¸‹çš„å°å‰‚é‡å‡é‡è¦ç‰¹åˆ«æ…¢\n"
            "- æ¯æ¬¡å‡é‡åå¯†åˆ‡è§‚å¯Ÿ2å‘¨\n\n"
            
            "## ğŸ¥ ç›‘æµ‹å’Œéšè®¿\n\n"
            "ç»´æŒæ²»ç–—æœŸé—´éœ€è¦å®šæœŸç›‘æµ‹ï¼š\n\n"
            "### æ¯2-4å‘¨å¤æŸ¥\n"
            "- å°¿å¸¸è§„ï¼ˆæœ€é‡è¦ï¼ï¼‰\n"
            "- è¡€å¸¸è§„ï¼ˆä½¿ç”¨å…ç–«æŠ‘åˆ¶å‰‚æœŸé—´ï¼‰\n"
            "- è‚åŠŸèƒ½\n\n"
            
            "### æ¯1-2æœˆå¤æŸ¥\n"
            "- è‚¾åŠŸèƒ½\n"
            "- 24å°æ—¶å°¿è›‹ç™½ï¼ˆå¦‚ä¹‹å‰å¼‚å¸¸ï¼‰\n\n"
            
            "### æ¯3æœˆå¤æŸ¥\n"
            "- è¡€ç³–ã€è¡€è„‚\n"
            "- éª¨å¯†åº¦ï¼ˆé•¿æœŸä½¿ç”¨æ¿€ç´ è€…ï¼‰\n\n"
            
            "## ğŸš¨ å‡ºç°ä»¥ä¸‹æƒ…å†µéœ€åŠæ—¶å°±è¯Š\n\n"
            "1. æ–°å‘çš®ç–¹\n"
            "2. å…³èŠ‚ç—›ã€è…¹ç—›\n"
            "3. å°¿æ¶²é¢œè‰²æ”¹å˜\n"
            "4. å‘çƒ­ã€ä¸¥é‡æ„ŸæŸ“\n"
            "5. è¡€å¸¸è§„å¼‚å¸¸ï¼ˆç™½ç»†èƒ<3.0ã€è¡€å°æ¿<100ï¼‰\n\n"
            
            "## ğŸ’¡ æˆ‘çš„å»ºè®®\n\n"
            "æ ¹æ®æ‚¨çš„æƒ…å†µï¼ˆç—…æƒ…ç¨³å®šï¼Œå‡†å¤‡æ¿€ç´ å‡é‡ï¼‰ï¼Œæˆ‘å»ºè®®ï¼š\n\n"
            "1. **é¦–é€‰ç¡«å”‘å˜Œå‘¤**ï¼šæœ€ç»å…¸çš„ç»´æŒæ²»ç–—è¯ç‰©ï¼Œæ€§ä»·æ¯”é«˜\n"
            "2. **é…åˆå¤æ–¹ç”˜è‰é…¸è‹·**ï¼šè¾…åŠ©æŠ—ç‚ï¼Œå¸®åŠ©æ¿€ç´ å‡é‡\n"
            "3. **ç»§ç»­è¡€ç®¡ä¿æŠ¤**ï¼šèŠ¦ä¸ + ç»´ç”Ÿç´ C\n"
            "4. **å®šæœŸå¤æŸ¥**ï¼šå°¤å…¶æ˜¯å°¿å¸¸è§„å’Œè¡€å¸¸è§„\n"
            "5. **ç¼“æ…¢å‡é‡**ï¼šä¸è¦æ€¥äºæ±‚æˆ\n\n"
            
            "## ğŸŒŸ é¢„åå±•æœ›\n\n"
            "å¤§å¤šæ•°æ‚£è€…é€šè¿‡è§„èŒƒçš„ç»´æŒæ²»ç–—å¯ä»¥æˆåŠŸå‡åœæ¿€ç´ ï¼Œå¹¶é•¿æœŸä¿æŒç—…æƒ…ç¨³å®šã€‚"
            "å…³é”®æ˜¯è¦æœ‰è€å¿ƒï¼Œä¸¥æ ¼éµåŒ»å˜±ï¼Œå®šæœŸéšè®¿ã€‚\n\n"
            
            "å¦‚æœæ‚¨è¿˜æœ‰ä»»ä½•ç–‘é—®ï¼Œæˆ–è€…åœ¨æ²»ç–—è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œéšæ—¶å¯ä»¥å’¨è¯¢æˆ‘ã€‚ç¥æ‚¨æ²»ç–—é¡ºåˆ©ï¼ğŸ’ª"
        )
        
        return response
    
    def _generate_response_for_azathioprine_inquiry(self) -> str:
        """ç”Ÿæˆå…³äºç¡«å”‘å˜Œå‘¤çš„å›å¤"""
        drug = self.kb.search_drug_by_name("ç¡«å”‘å˜Œå‘¤")
        
        response = (
            "å¾ˆé«˜å…´æ‚¨ä¸»åŠ¨äº†è§£è¯ç‰©ä¿¡æ¯ï¼Œè¿™ä½“ç°äº†æ‚¨å¯¹æ²»ç–—çš„é‡è§†ã€‚è®©æˆ‘è¯¦ç»†ä¸ºæ‚¨ä»‹ç»ç¡«å”‘å˜Œå‘¤è¿™ä¸ªè¯ç‰©ã€‚\n\n"
            
            f"## ğŸ’Š {drug['name']}è¯¦ç»†ä¿¡æ¯\n\n"
            
            "### è¿™æ˜¯ä»€ä¹ˆè¯ï¼Ÿ\n\n"
            f"{drug['name']}æ˜¯ä¸€ç§å…ç–«æŠ‘åˆ¶å‰‚ï¼Œé€šè¿‡æŠ‘åˆ¶å…ç–«ç»†èƒçš„å¢æ®–æ¥æ§åˆ¶è¿‡åº¦çš„å…ç–«ååº”ã€‚"
            f"å®ƒåœ¨æ²»ç–—è‡ªèº«å…ç–«æ€§ç–¾ç—…æ–¹é¢æœ‰å‡ åå¹´çš„ä½¿ç”¨ç»éªŒï¼Œæ˜¯éå¸¸ç»å…¸çš„è¯ç‰©ã€‚\n\n"
            
            f"### ä½œç”¨æœºåˆ¶\n\n{drug['mechanism']}\n\n"
            
            f"### ç”¨æ³•ç”¨é‡\n\n{drug['dosage']}\n\n"
            
            "### âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ï¼ˆå¿…è¯»ï¼ï¼‰\n\n"
        )
        
        for i, precaution in enumerate(drug['precautions'], 1):
            response += f"**{i}. {precaution}**\n\n"
        
        response += (
            "### å¸¸è§å‰¯ä½œç”¨åŠåº”å¯¹\n\n"
            "1. **éª¨é«“æŠ‘åˆ¶ï¼ˆç™½ç»†èƒå‡å°‘ï¼‰**\n"
            "   - æœ€å¸¸è§çš„å‰¯ä½œç”¨\n"
            "   - å®šæœŸå¤æŸ¥è¡€å¸¸è§„å¯åŠæ—¶å‘ç°\n"
            "   - å¦‚ç™½ç»†èƒ<3.0ï¼Œéœ€å‡é‡æˆ–åœè¯\n"
            "   - åœè¯åå¯æ¢å¤\n\n"
            
            "2. **è‚åŠŸèƒ½å¼‚å¸¸**\n"
            "   - å¯èƒ½å‡ºç°è½¬æ°¨é…¶å‡é«˜\n"
            "   - æ¯æœˆå¤æŸ¥è‚åŠŸèƒ½\n"
            "   - è½»åº¦å‡é«˜å¯ç»§ç»­è§‚å¯Ÿï¼Œæ˜æ˜¾å‡é«˜éœ€åœè¯\n\n"
            
            "3. **èƒƒè‚ é“ååº”**\n"
            "   - æ¶å¿ƒã€é£Ÿæ¬²ä¸æŒ¯\n"
            "   - é¥­åæœç”¨å¯å‡è½»\n"
            "   - åˆ†æ¬¡æœç”¨ï¼ˆå¦‚åˆ†2-3æ¬¡ï¼‰ä¹Ÿæœ‰å¸®åŠ©\n\n"
            
            "4. **è„±å‘**\n"
            "   - éƒ¨åˆ†æ‚£è€…å‡ºç°\n"
            "   - ä¸€èˆ¬è¾ƒè½»å¾®\n"
            "   - åœè¯åå¯æ¢å¤\n\n"
            
            "### è¯ç‰©ç›¸äº’ä½œç”¨\n\n"
            "âš ï¸ **ç‰¹åˆ«é‡è¦**ï¼šç¡«å”‘å˜Œå‘¤ä¸åˆ«å˜Œé†‡ï¼ˆæ²»ç–—ç—›é£çš„è¯ï¼‰åˆç”¨ä¼šå¢åŠ éª¨é«“æŠ‘åˆ¶é£é™©ï¼\n"
            "å¦‚æœæ‚¨éœ€è¦åŒæ—¶æœç”¨åˆ«å˜Œé†‡ï¼Œç¡«å”‘å˜Œå‘¤å‰‚é‡éœ€è¦å‡è‡³1/3-1/4ã€‚\n\n"
            
            "### ç”Ÿè‚²ç›¸å…³\n\n"
            "- **ç”·æ€§**ï¼šå¯èƒ½å½±å“ç²¾å­è´¨é‡ï¼Œä½†ç›¸å¯¹è¾ƒè½»\n"
            "- **å¥³æ€§**ï¼šå­•æœŸç¦ç”¨ï¼Œæœ‰è‡´ç•¸é£é™©\n"
            "- **å»ºè®®**ï¼šè®¡åˆ’æ€€å­•å‰3-6ä¸ªæœˆåœè¯\n"
            "- **é¿å­•**ï¼šè‚²é¾„æœŸå¥³æ€§å¿…é¡»ä¸¥æ ¼é¿å­•\n\n"
            
            "### èµ·æ•ˆæ—¶é—´\n\n"
            "ç¡«å”‘å˜Œå‘¤ä¸æ˜¯é€Ÿæ•ˆè¯ï¼Œé€šå¸¸éœ€è¦**8-12å‘¨**æ‰èƒ½çœ‹åˆ°æ•ˆæœã€‚æ‰€ä»¥ï¼š\n"
            "- ä¸è¦å› ä¸ºçŸ­æœŸå†…æ— æ˜æ˜¾æ•ˆæœå°±è‡ªè¡Œåœè¯\n"
            "- åœ¨èµ·æ•ˆå‰ï¼Œå¯èƒ½éœ€è¦ç»§ç»­ä½¿ç”¨æ¿€ç´ æ§åˆ¶ç—…æƒ…\n"
            "- ä¸€æ—¦èµ·æ•ˆï¼Œå¯ä»¥å¸®åŠ©å‡å°‘æ¿€ç´ ç”¨é‡\n\n"
            
            "### æœè¯æœŸé—´çš„ç›‘æµ‹\n\n"
            "**å¿…é¡»å®šæœŸå¤æŸ¥**ï¼ˆéå¸¸é‡è¦ï¼ï¼‰ï¼š\n\n"
            "| æ—¶é—´ | æ£€æŸ¥é¡¹ç›® |\n"
            "|------|----------|\n"
            "| å‰1-2ä¸ªæœˆ | æ¯1-2å‘¨æŸ¥è¡€å¸¸è§„ã€è‚åŠŸèƒ½ |\n"
            "| 2ä¸ªæœˆåç—…æƒ…ç¨³å®š | æ¯4å‘¨æŸ¥è¡€å¸¸è§„ã€è‚åŠŸèƒ½ |\n"
            "| é•¿æœŸç»´æŒ | æ¯2-3æœˆå¤æŸ¥ |\n\n"
            
            "### ğŸ’¡ æœè¯å°è´´å£«\n\n"
            "1. **å›ºå®šæ—¶é—´æœè¯**ï¼šå»ºè®®æ¯å¤©åŒä¸€æ—¶é—´ï¼Œä¾¿äºè®°å¿†\n"
            "2. **é¥­åæœç”¨**ï¼šå‡å°‘èƒƒè‚ é“åˆºæ¿€\n"
            "3. **æ•´ç‰‡åæœ**ï¼šä¸è¦æ°å¼€æˆ–å’€åš¼\n"
            "4. **é¿å…‰ä¿å­˜**ï¼šæ”¾åœ¨é˜´å‡‰å¹²ç‡¥å¤„\n"
            "5. **ä¸è¦è‡ªè¡Œåœè¯**ï¼šå³ä½¿æ„Ÿè§‰å¥½è½¬ï¼Œä¹Ÿéœ€åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹åœè¯\n\n"
            
            "### ğŸš¨ å‡ºç°ä»¥ä¸‹æƒ…å†µç«‹å³å°±åŒ»\n\n"
            "1. **å‘çƒ­**ï¼ˆä½“æ¸©>38Â°Cï¼‰\n"
            "2. **å’½ç—›ã€å£è…”æºƒç–¡**ï¼ˆå¯èƒ½æ˜¯ç™½ç»†èƒå‡å°‘ï¼‰\n"
            "3. **çš®è‚¤å‡ºè¡€ç‚¹ã€ç‰™é¾ˆå‡ºè¡€**ï¼ˆå¯èƒ½æ˜¯è¡€å°æ¿å‡å°‘ï¼‰\n"
            "4. **ä¸¥é‡æ¶å¿ƒå‘•å**\n"
            "5. **é»„ç–¸**ï¼ˆçš®è‚¤ã€çœ¼ç›å‘é»„ï¼‰\n\n"
            
            "### ğŸŒŸ æ€»ç»“\n\n"
            "ç¡«å”‘å˜Œå‘¤æ˜¯ä¸€ä¸ªç–—æ•ˆç¡®åˆ‡ã€ç»éªŒä¸°å¯Œçš„å…ç–«æŠ‘åˆ¶å‰‚ã€‚è™½ç„¶æœ‰å‰¯ä½œç”¨ï¼Œä½†é€šè¿‡å®šæœŸç›‘æµ‹æ˜¯å¯ä»¥åŠæ—¶å‘ç°å’Œå¤„ç†çš„ã€‚"
            "å¤§å¤šæ•°æ‚£è€…éƒ½èƒ½è‰¯å¥½è€å—ï¼Œå¹¶ä»ä¸­è·ç›Šã€‚\n\n"
            
            "**å…³é”®æ˜¯**ï¼š\n"
            "- âœ… æŒ‰æ—¶æœè¯\n"
            "- âœ… å®šæœŸå¤æŸ¥\n"
            "- âœ… æœ‰é—®é¢˜åŠæ—¶å°±åŒ»\n"
            "- âœ… ä¸è¦è‡ªè¡Œåœè¯\n\n"
            
            "å¦‚æœæ‚¨è¿˜æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶é—®æˆ‘ã€‚ç¥æ‚¨æ²»ç–—é¡ºåˆ©ï¼ğŸ’ª"
        )
        
        return response
    
    def _generate_response_for_steroid_comparison(self) -> str:
        """ç”Ÿæˆæ¿€ç´ ç±»è¯ç‰©å¯¹æ¯”å›å¤"""
        prednisone = self.kb.search_drug_by_name("æ³¼å°¼æ¾")
        methylpred = self.kb.search_drug_by_name("ç”²æ³¼å°¼é¾™")
        
        response = (
            "è¿™æ˜¯ä¸€ä¸ªå¾ˆä¸“ä¸šçš„é—®é¢˜ï¼æ³¼å°¼æ¾å’Œç”²æ³¼å°¼é¾™éƒ½æ˜¯ç³–çš®è´¨æ¿€ç´ ï¼Œä½†ç¡®å®æœ‰ä¸€äº›åŒºåˆ«ã€‚è®©æˆ‘è¯¦ç»†ä¸ºæ‚¨å¯¹æ¯”ä¸€ä¸‹ã€‚\n\n"
            
            "## ğŸ’Š æ³¼å°¼æ¾ vs ç”²æ³¼å°¼é¾™å¯¹æ¯”\n\n"
            
            "### 1. åŸºæœ¬ç‰¹æ€§å¯¹æ¯”\n\n"
            
            "| ç‰¹æ€§ | æ³¼å°¼æ¾ | ç”²æ³¼å°¼é¾™ |\n"
            "|------|--------|----------|\n"
            "| æŠ—ç‚å¼ºåº¦ | 4å€ï¼ˆç›¸å¯¹äºæ°¢åŒ–å¯çš„æ¾ï¼‰ | 5å€ |\n"
            "| ä½œç”¨æ—¶é—´ | 12-36å°æ—¶ï¼ˆä¸­æ•ˆï¼‰ | 12-36å°æ—¶ï¼ˆä¸­æ•ˆï¼‰ |\n"
            "| æ°´é’ æ½´ç•™ | ä¸­ç­‰ | è¾ƒè½» |\n"
            "| å‰‚å‹ | ä¸»è¦æ˜¯å£æœç‰‡å‰‚ | å£æœã€é™è„‰éƒ½æœ‰ |\n"
            "| ç­‰æ•ˆå‰‚é‡ | 5mg | 4mg |\n\n"
            
            "### 2. æ³¼å°¼æ¾çš„ç‰¹ç‚¹\n\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{prednisone['dosage']}\n"
            "- **ä¼˜ç‚¹**ï¼š\n"
            "  - æœ€ç»å…¸ã€æœ€å¸¸ç”¨çš„å£æœæ¿€ç´ \n"
            "  - ç»éªŒæœ€ä¸°å¯Œï¼ŒåŒ»ç”Ÿæœ€ç†Ÿæ‚‰\n"
            "  - ä»·æ ¼ä¾¿å®œ\n"
            "  - è¯åº—å®¹æ˜“ä¹°åˆ°\n"
            "- **ç¼ºç‚¹**ï¼š\n"
            "  - éœ€è¦åœ¨è‚è„è½¬åŒ–ä¸ºæ´»æ€§å½¢å¼ï¼ˆæ³¼å°¼æ¾é¾™ï¼‰\n"
            "  - è‚åŠŸèƒ½ä¸å¥½çš„æ‚£è€…è½¬åŒ–å¯èƒ½å—å½±å“\n"
            "  - æ°´é’ æ½´ç•™ç›¸å¯¹æ˜æ˜¾ä¸€äº›\n\n"
            
            "### 3. ç”²æ³¼å°¼é¾™çš„ç‰¹ç‚¹\n\n"
            f"- **ç”¨æ³•ç”¨é‡**ï¼š{methylpred['dosage']}\n"
            "- **ä¼˜ç‚¹**ï¼š\n"
            "  - æŠ—ç‚ä½œç”¨æ›´å¼º\n"
            "  - æ°´é’ æ½´ç•™ä½œç”¨è¾ƒè½»ï¼ˆæµ®è‚¿ç›¸å¯¹å°‘ï¼‰\n"
            "  - ä¸éœ€è¦è‚è„è½¬åŒ–ï¼Œç›´æ¥èµ·æ•ˆ\n"
            "  - æœ‰é™è„‰å‰‚å‹ï¼Œå¯ç”¨äºå†²å‡»æ²»ç–—\n"
            "- **ç¼ºç‚¹**ï¼š\n"
            "  - ä»·æ ¼ç¨è´µ\n"
            "  - å¤§å‰‚é‡å†²å‡»æ²»ç–—éœ€è¦ä½é™¢\n\n"
            
            "### 4. å¦‚ä½•é€‰æ‹©ï¼Ÿ\n\n"
            
            "#### é€‰æ‹©æ³¼å°¼æ¾çš„æƒ…å†µï¼š\n"
            "- âœ… è½»ä¸­åº¦è¿‡æ•æ€§ç´«ç™œ\n"
            "- âœ… é•¿æœŸç»´æŒæ²»ç–—\n"
            "- âœ… é—¨è¯Šå£æœæ²»ç–—\n"
            "- âœ… ç»æµè€ƒè™‘\n"
            "- âœ… è‚åŠŸèƒ½æ­£å¸¸\n\n"
            
            "#### é€‰æ‹©ç”²æ³¼å°¼é¾™çš„æƒ…å†µï¼š\n"
            "- âœ… é‡ç—‡ç´«ç™œæ€§è‚¾ç‚ï¼ˆéœ€è¦å†²å‡»æ²»ç–—ï¼‰\n"
            "- âœ… ç—…æƒ…è¿›å±•è¿…é€Ÿ\n"
            "- âœ… æœ‰æ˜æ˜¾æµ®è‚¿ã€é«˜è¡€å‹\n"
            "- âœ… è‚åŠŸèƒ½ä¸è‰¯ï¼ˆä¸éœ€è‚è„è½¬åŒ–ï¼‰\n"
            "- âœ… æ³¼å°¼æ¾æ•ˆæœä¸ä½³æ—¶\n\n"
            
            "### 5. å‰‚é‡æ¢ç®—\n\n"
            "å¦‚æœéœ€è¦åœ¨ä¸¤ç§è¯ç‰©é—´è½¬æ¢ï¼š\n"
            "- æ³¼å°¼æ¾ 5mg â‰ˆ ç”²æ³¼å°¼é¾™ 4mg\n"
            "- ä¾‹å¦‚ï¼šæ³¼å°¼æ¾ 30mg/å¤© â‰ˆ ç”²æ³¼å°¼é¾™ 24mg/å¤©\n\n"
            
            "### 6. å‰¯ä½œç”¨å¯¹æ¯”\n\n"
            
            "#### å…±åŒçš„å‰¯ä½œç”¨ï¼š\n"
            "- è¡€ç³–å‡é«˜\n"
            "- éª¨è´¨ç–æ¾\n"
            "- å…ç–«æŠ‘åˆ¶ã€æ˜“æ„ŸæŸ“\n"
            "- å¤±çœ ã€æƒ…ç»ªæ³¢åŠ¨\n"
            "- é£Ÿæ¬²å¢åŠ ã€ä½“é‡å¢åŠ \n"
            "- æ»¡æœˆè„¸ã€æ°´ç‰›èƒŒ\n\n"
            
            "#### ä¸åŒä¹‹å¤„ï¼š\n"
            "- **æ³¼å°¼æ¾**ï¼šæ°´é’ æ½´ç•™ã€æµ®è‚¿ç›¸å¯¹å¤šè§\n"
            "- **ç”²æ³¼å°¼é¾™**ï¼šæ°´é’ æ½´ç•™è¾ƒè½»ï¼Œä½†ä»·æ ¼ç¨è´µ\n\n"
            
            "### 7. âš ï¸ ä¸¤ç§è¯ç‰©é€šç”¨çš„æ³¨æ„äº‹é¡¹\n\n"
        )
        
        for precaution in prednisone['precautions']:
            response += f"- {precaution}\n"
        
        response += (
            "\n### 8. ğŸ’¡ æˆ‘çš„å»ºè®®\n\n"
            
            "**å¯¹äºå¤§å¤šæ•°è¿‡æ•æ€§ç´«ç™œæ‚£è€…**ï¼š\n"
            "- **é¦–é€‰æ³¼å°¼æ¾**ï¼šç»éªŒä¸°å¯Œï¼Œæ€§ä»·æ¯”é«˜ï¼Œé€‚åˆé—¨è¯Šå£æœæ²»ç–—\n"
            "- **å¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œè€ƒè™‘æ¢ç”¨ç”²æ³¼å°¼é¾™**ï¼š\n"
            "  - æµ®è‚¿æ˜æ˜¾\n"
            "  - é«˜è¡€å‹éš¾ä»¥æ§åˆ¶\n"
            "  - ç—…æƒ…é‡ï¼Œéœ€è¦å†²å‡»æ²»ç–—\n"
            "  - æ³¼å°¼æ¾æ•ˆæœä¸ä½³\n\n"
            
            "**ä¸¤ç§è¯ç‰©ç–—æ•ˆéƒ½æ˜¯ç¡®åˆ‡çš„**ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå‰¯ä½œç”¨ç‰¹ç‚¹å’Œç»™è¯é€”å¾„ã€‚"
            "å…·ä½“é€‰æ‹©å“ªç§ï¼Œåº”è¯¥ç”±åŒ»ç”Ÿæ ¹æ®æ‚¨çš„ç—…æƒ…ã€ç»æµæƒ…å†µå’Œä¸ªäººä½“è´¨æ¥å†³å®šã€‚\n\n"
            
            "### 9. ğŸš¨ é‡è¦æé†’\n\n"
            "æ— è®ºä½¿ç”¨å“ªç§æ¿€ç´ ï¼š\n"
            "1. **ä¸èƒ½çªç„¶åœè¯**ï¼šå¿…é¡»ç¼“æ…¢å‡é‡\n"
            "2. **ä¸èƒ½è‡ªè¡Œè°ƒæ•´å‰‚é‡**ï¼šéµåŒ»å˜±\n"
            "3. **å®šæœŸå¤æŸ¥**ï¼šç›‘æµ‹å‰¯ä½œç”¨\n"
            "4. **é¢„é˜²éª¨è´¨ç–æ¾**ï¼šè¡¥å……é’™+ç»´ç”Ÿç´ D\n"
            "5. **é¢„é˜²æ„ŸæŸ“**ï¼šæ³¨æ„ä¸ªäººå«ç”Ÿ\n\n"
            
            "å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶å’¨è¯¢ã€‚ç¥æ‚¨æ²»ç–—é¡ºåˆ©ï¼ğŸ’ª"
        )
        
        return response
    
    def generate_all_training_data(self) -> List[Dict[str, Any]]:
        """ç”Ÿæˆæ‰€æœ‰è®­ç»ƒæ•°æ®"""
        console.print("\n[bold blue]ğŸ”§ å¼€å§‹ç”Ÿæˆè¯ç‰©è®­ç»ƒæ•°æ®...[/bold blue]\n")
        
        # ç”Ÿæˆå…·ä½“ç–¾ç—…æ¡ˆä¾‹
        disease_cases = self.create_specific_disease_cases()
        console.print(f"[green]âœ… ç”Ÿæˆå…·ä½“ç–¾ç—…æ¡ˆä¾‹: {len(disease_cases)} æ¡[/green]")
        
        self.generated_data.extend(disease_cases)
        
        return self.generated_data
    
    def save_to_file(self, output_path: str):
        """ä¿å­˜è®­ç»ƒæ•°æ®åˆ°æ–‡ä»¶"""
        with open(output_path, 'w', encoding='utf-8') as f:
            json.dump(self.generated_data, f, ensure_ascii=False, indent=2)
        console.print(f"\n[green]âœ… è®­ç»ƒæ•°æ®å·²ä¿å­˜åˆ°: {output_path}[/green]")
        
    def save_to_jsonl(self, output_path: str):
        """ä¿å­˜ä¸ºJSONLæ ¼å¼"""
        with open(output_path, 'w', encoding='utf-8') as f:
            for item in self.generated_data:
                f.write(json.dumps(item, ensure_ascii=False) + '\n')
        console.print(f"[green]âœ… JSONLæ ¼å¼å·²ä¿å­˜åˆ°: {output_path}[/green]")


def main():
    """ä¸»å‡½æ•°"""
    console.print(Panel.fit(
        "[bold green]ğŸ’Š è¯ç‰©è®­ç»ƒæ•°æ®ç”Ÿæˆå™¨[/bold green]\n"
        "ç”ŸæˆåŒ…å«å…·ä½“è¯ç‰©åç§°å’Œç”¨è¯æŒ‡å¯¼çš„è®­ç»ƒæ•°æ®",
        border_style="green"
    ))
    
    # åˆ›å»ºç”Ÿæˆå™¨
    generator = DrugTrainingDataGenerator()
    
    # ç”Ÿæˆæ•°æ®
    data = generator.generate_all_training_data()
    
    # ä¿å­˜æ•°æ®
    from config import PROCESSED_DATA_DIR
    output_dir = Path(PROCESSED_DATA_DIR)
    output_dir.mkdir(parents=True, exist_ok=True)
    
    # ä¿å­˜ä¸ºJSON
    json_path = output_dir / "drug_training_data.json"
    generator.save_to_file(str(json_path))
    
    # ä¿å­˜ä¸ºJSONL
    jsonl_path = output_dir / "drug_training_data.jsonl"
    generator.save_to_jsonl(str(jsonl_path))
    
    # æ˜¾ç¤ºç»Ÿè®¡
    console.print(f"\n[bold blue]ğŸ“Š ç”Ÿæˆç»Ÿè®¡[/bold blue]")
    console.print(f"æ€»æ•°æ®é‡: {len(data)} æ¡")
    
    # æŒ‰æ¡ä»¶åˆ†ç±»ç»Ÿè®¡
    conditions = {}
    for item in data:
        cond = item.get('metadata', {}).get('condition', 'other')
        conditions[cond] = conditions.get(cond, 0) + 1
    
    console.print(f"\n[bold blue]æŒ‰ç–¾ç—…åˆ†ç±»ï¼š[/bold blue]")
    for cond, count in conditions.items():
        console.print(f"  - {cond}: {count} æ¡")
    
    console.print(f"\n[bold green]ğŸ‰ å®Œæˆï¼[/bold green]")


if __name__ == "__main__":
    main()

