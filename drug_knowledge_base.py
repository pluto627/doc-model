#!/usr/bin/env python3
"""
è¯ç‰©çŸ¥è¯†åº“ç³»ç»Ÿ
ç”¨äºæä¾›å…·ä½“è¯ç‰©åç§°ã€ç”¨æ³•ç”¨é‡å’Œæ³¨æ„äº‹é¡¹
"""

from typing import List, Dict, Any, Optional
import json
import random


class DrugKnowledgeBase:
    """è¯ç‰©çŸ¥è¯†åº“"""
    
    def __init__(self):
        self.drugs = self._init_drug_database()
        
    def _init_drug_database(self) -> Dict[str, List[Dict[str, Any]]]:
        """
        åˆå§‹åŒ–è¯ç‰©æ•°æ®åº“
        æŒ‰ç…§è¯ç‰©ç±»åˆ«ç»„ç»‡
        """
        return {
            # éç”¾ä½“æŠ—ç‚è¯ (NSAIDs)
            "éç”¾ä½“æŠ—ç‚è¯": [
                {
                    "name": "å¸ƒæ´›èŠ¬",
                    "generic_name": "Ibuprofen",
                    "dosage": "æˆäººï¼šæ¯æ¬¡200-400mgï¼Œæ¯æ—¥3-4æ¬¡ï¼Œé¥­åæœç”¨",
                    "indications": ["å‘çƒ­", "ç–¼ç—›", "å…³èŠ‚ç‚", "è¿‡æ•æ€§ç´«ç™œç—‡çŠ¶ç¼“è§£"],
                    "mechanism": "é€šè¿‡æŠ‘åˆ¶ç¯æ°§åŒ–é…¶(COX)ï¼Œå‡å°‘å‰åˆ—è…ºç´ åˆæˆï¼Œå‘æŒ¥æŠ—ç‚ã€è§£çƒ­ã€é•‡ç—›ä½œç”¨",
                    "precautions": [
                        "èƒƒè‚ é“ä¸é€‚è€…é¥­åæœç”¨ï¼Œå¿…è¦æ—¶åŠ ç”¨èƒƒä¿æŠ¤å‰‚",
                        "é¿å…ä¸é˜¿å¸åŒ¹æ—åŒæ—¶ä½¿ç”¨",
                        "æœ‰æ¶ˆåŒ–æ€§æºƒç–¡ã€å“®å–˜å²è€…æ…ç”¨",
                        "ä¸å®œé•¿æœŸå¤§å‰‚é‡ä½¿ç”¨ï¼Œä»¥å…å¢åŠ å¿ƒè¡€ç®¡é£é™©",
                        "å„¿ç«¥ç”¨é‡éœ€æ ¹æ®ä½“é‡è®¡ç®—ï¼ˆ10mg/kg/æ¬¡ï¼‰"
                    ],
                    "side_effects": ["èƒƒéƒ¨ä¸é€‚", "æ¶å¿ƒ", "å¤´æ™•", "çš®ç–¹"],
                    "contraindications": ["æ´»åŠ¨æ€§æ¶ˆåŒ–æ€§æºƒç–¡", "ä¸¥é‡è‚è‚¾åŠŸèƒ½ä¸å…¨", "å­•æ™šæœŸ"]
                },
                {
                    "name": "å¡æ¥æ˜”å¸ƒ",
                    "generic_name": "Celecoxib",
                    "dosage": "æˆäººï¼šæ¯æ¬¡200mgï¼Œæ¯æ—¥1-2æ¬¡",
                    "indications": ["éª¨å…³èŠ‚ç‚", "ç±»é£æ¹¿å…³èŠ‚ç‚", "è¿‡æ•æ€§ç´«ç™œå…³èŠ‚ç—‡çŠ¶"],
                    "mechanism": "é€‰æ‹©æ€§COX-2æŠ‘åˆ¶å‰‚ï¼ŒæŠ—ç‚ä½œç”¨å¼ºï¼Œèƒƒè‚ é“å‰¯ä½œç”¨ç›¸å¯¹è¾ƒå°",
                    "precautions": [
                        "å¯¹ç£ºèƒºç±»è¯ç‰©è¿‡æ•è€…ç¦ç”¨",
                        "æœ‰å¿ƒè¡€ç®¡ç–¾ç—…é£é™©è€…æ…ç”¨",
                        "é¿å…ä¸åæ³•æ—ç­‰æŠ—å‡è¯è”ç”¨",
                        "æœè¯æœŸé—´å®šæœŸç›‘æµ‹è‚è‚¾åŠŸèƒ½"
                    ],
                    "side_effects": ["è…¹ç—›", "è…¹æ³»", "å¤´ç—›", "æ°´è‚¿"],
                    "contraindications": ["ç£ºèƒºè¿‡æ•", "ä¸¥é‡å¿ƒåŠ›è¡°ç«­", "æ´»åŠ¨æ€§æ¶ˆåŒ–é“å‡ºè¡€"]
                },
                {
                    "name": "å²å“šç¾è¾›",
                    "generic_name": "Indomethacin",
                    "dosage": "æˆäººï¼šæ¯æ¬¡25mgï¼Œæ¯æ—¥2-3æ¬¡ï¼Œé¥­åæœç”¨",
                    "indications": ["ä¸­é‡åº¦ç‚ç—‡æ€§ç–¼ç—›", "ç—›é£æ€§å…³èŠ‚ç‚", "å¼ºç›´æ€§è„ŠæŸ±ç‚"],
                    "mechanism": "éé€‰æ‹©æ€§COXæŠ‘åˆ¶å‰‚ï¼ŒæŠ—ç‚ä½œç”¨å¼º",
                    "precautions": [
                        "èƒƒè‚ é“ååº”è¾ƒé‡ï¼Œå¿…é¡»é¥­åæœç”¨",
                        "æœ‰ç²¾ç¥ç—…å²ã€ç™«ç—«æ‚£è€…æ…ç”¨",
                        "å¯èƒ½å¼•èµ·å¤´æ™•ï¼Œæœè¯åé¿å…é©¾é©¶",
                        "è€å¹´äººåº”å‡é‡ä½¿ç”¨"
                    ],
                    "side_effects": ["æ¶å¿ƒå‘•å", "å¤´ç—›çœ©æ™•", "æ¶ˆåŒ–æ€§æºƒç–¡", "è¡€å°æ¿åŠŸèƒ½å—æŠ‘"],
                    "contraindications": ["æ¶ˆåŒ–æ€§æºƒç–¡", "ç²¾ç¥ç—…å²", "å­•å¦‡åŠå“ºä¹³æœŸå¦‡å¥³"]
                }
            ],
            
            # ç³–çš®è´¨æ¿€ç´ 
            "ç³–çš®è´¨æ¿€ç´ ": [
                {
                    "name": "æ³¼å°¼æ¾",
                    "generic_name": "Prednisone",
                    "dosage": "åˆå§‹å‰‚é‡ï¼š0.5-1mg/kg/å¤©ï¼Œæ ¹æ®ç—…æƒ…é€æ¸å‡é‡",
                    "indications": ["è¿‡æ•æ€§ç´«ç™œæ€¥æ€§æœŸ", "è‡ªèº«å…ç–«æ€§ç–¾ç—…", "ä¸¥é‡è¿‡æ•ååº”"],
                    "mechanism": "æŠ‘åˆ¶ç‚ç—‡ååº”ï¼Œå‡è½»è¡€ç®¡é€šé€æ€§ï¼ŒæŠ‘åˆ¶å…ç–«ååº”",
                    "precautions": [
                        "æ—©æ™¨8ç‚¹å‰æœç”¨ï¼Œæ¨¡æ‹Ÿç”Ÿç†æ€§åˆ†æ³ŒèŠ‚å¾‹",
                        "ä¸å¯çªç„¶åœè¯ï¼Œéœ€ç¼“æ…¢å‡é‡",
                        "é•¿æœŸä½¿ç”¨éœ€è¡¥å……é’™å‰‚å’Œç»´ç”Ÿç´ Dï¼Œé¢„é˜²éª¨è´¨ç–æ¾",
                        "å®šæœŸç›‘æµ‹è¡€ç³–ã€è¡€å‹ã€ç”µè§£è´¨",
                        "é¿å…æ¥è§¦æ°´ç—˜ã€éº»ç–¹ç­‰ä¼ æŸ“ç—…æ‚£è€…",
                        "æœè¯æœŸé—´é¿å…æ¥ç§æ´»ç–«è‹—"
                    ],
                    "side_effects": ["é£Ÿæ¬²å¢åŠ ", "ä½“é‡å¢åŠ ", "å¤±çœ ", "æƒ…ç»ªæ³¢åŠ¨", "æ»¡æœˆè„¸", "å‘å¿ƒæ€§è‚¥èƒ–"],
                    "contraindications": ["æ´»åŠ¨æ€§æ„ŸæŸ“", "æœªæ§åˆ¶çš„ç³–å°¿ç—…", "æ¶ˆåŒ–æ€§æºƒç–¡"]
                },
                {
                    "name": "ç”²æ³¼å°¼é¾™",
                    "generic_name": "Methylprednisolone",
                    "dosage": "å£æœï¼šæ¯æ—¥4-48mgï¼Œåˆ†æ¬¡æœç”¨ï¼›å†²å‡»æ²»ç–—ï¼š500-1000mg/å¤©ï¼Œé™è„‰æ»´æ³¨3-5å¤©",
                    "indications": ["é‡ç—‡è¿‡æ•æ€§ç´«ç™œ", "ç´«ç™œæ€§è‚¾ç‚", "ä¸¥é‡è‡ªèº«å…ç–«æ€§ç–¾ç—…"],
                    "mechanism": "æ¯”æ³¼å°¼æ¾æŠ—ç‚ä½œç”¨æ›´å¼ºï¼Œæ°´é’ æ½´ç•™ä½œç”¨è¾ƒè½»",
                    "precautions": [
                        "å†²å‡»æ²»ç–—éœ€åœ¨åŒ»é™¢è¿›è¡Œï¼Œå¯†åˆ‡ç›‘æµ‹ç”Ÿå‘½ä½“å¾",
                        "æ³¨æ„é¢„é˜²æ„ŸæŸ“ï¼Œå‡ºç°å‘çƒ­åŠæ—¶å°±è¯Š",
                        "å¯èƒ½å¼•èµ·é«˜è¡€ç³–ï¼Œç³–å°¿ç—…æ‚£è€…éœ€è°ƒæ•´é™ç³–æ–¹æ¡ˆ",
                        "è¡¥é’¾ï¼Œé¢„é˜²ä½é’¾è¡€ç—‡",
                        "é€æ¸å‡é‡ï¼Œé€šå¸¸æ¯å‘¨å‡å°‘5-10mg"
                    ],
                    "side_effects": ["è¡€ç³–å‡é«˜", "è¡€å‹å‡é«˜", "æ¶ˆåŒ–é“ä¸é€‚", "éª¨è´¨ç–æ¾", "è‚¡éª¨å¤´åæ­»"],
                    "contraindications": ["ä¸¥é‡æ„ŸæŸ“", "æ´»åŠ¨æ€§ç»“æ ¸", "ç²¾ç¥ç—…å²"]
                },
                {
                    "name": "åœ°å¡ç±³æ¾",
                    "generic_name": "Dexamethasone",
                    "dosage": "å£æœï¼šæ¯æ—¥0.75-9mgï¼›é™è„‰ï¼š5-20mg/æ¬¡",
                    "indications": ["æ€¥æ€§è¿‡æ•ååº”", "è„‘æ°´è‚¿", "ä¸¥é‡ç‚ç—‡"],
                    "mechanism": "é•¿æ•ˆç³–çš®è´¨æ¿€ç´ ï¼ŒæŠ—ç‚ä½œç”¨å¼ºï¼Œä½œç”¨æ—¶é—´é•¿ï¼ˆ36-54å°æ—¶ï¼‰",
                    "precautions": [
                        "é•¿æ•ˆæ¿€ç´ ï¼Œæ›´å®¹æ˜“æŠ‘åˆ¶ä¸‹ä¸˜è„‘-å‚ä½“-è‚¾ä¸Šè…ºè½´",
                        "ä¸é€‚åˆé•¿æœŸæ¯æ—¥ä½¿ç”¨",
                        "å‡é‡è¦æ›´åŠ è°¨æ…ç¼“æ…¢",
                        "å¯¹æ°´é’ ä»£è°¢å½±å“å°äºæ³¼å°¼æ¾"
                    ],
                    "side_effects": ["HPAè½´æŠ‘åˆ¶", "å…ç–«æŠ‘åˆ¶", "éª¨è´¨ç–æ¾", "è‚Œæ— åŠ›"],
                    "contraindications": ["çœŸèŒæ„ŸæŸ“", "æ´»åŠ¨æ€§ç—…æ¯’æ„ŸæŸ“", "ç²¾ç¥å¼‚å¸¸"]
                }
            ],
            
            # å…ç–«è°ƒèŠ‚å‰‚/å…ç–«æŠ‘åˆ¶å‰‚
            "å…ç–«è°ƒèŠ‚å‰‚": [
                {
                    "name": "ç¡«å”‘å˜Œå‘¤",
                    "generic_name": "Azathioprine",
                    "dosage": "åˆå§‹å‰‚é‡ï¼š1-2mg/kg/å¤©ï¼Œåˆ†æ¬¡å£æœ",
                    "indications": ["æ¿€ç´ ä¾èµ–å‹è¿‡æ•æ€§ç´«ç™œ", "ç´«ç™œæ€§è‚¾ç‚", "è‡ªèº«å…ç–«æ€§ç–¾ç—…ç»´æŒæ²»ç–—"],
                    "mechanism": "å˜Œå‘¤ç±»ä¼¼ç‰©ï¼ŒæŠ‘åˆ¶æ ¸é…¸åˆæˆï¼Œå‡å°‘Tç»†èƒå’ŒBç»†èƒå¢æ®–",
                    "precautions": [
                        "éœ€å®šæœŸå¤æŸ¥è¡€å¸¸è§„ï¼ˆæ¯1-2å‘¨ï¼‰ï¼Œç›‘æµ‹ç™½ç»†èƒå’Œè¡€å°æ¿",
                        "å®šæœŸå¤æŸ¥è‚åŠŸèƒ½ï¼ˆæ¯æœˆï¼‰",
                        "èµ·æ•ˆè¾ƒæ…¢ï¼Œé€šå¸¸éœ€8-12å‘¨",
                        "é¿å…ä¸åˆ«å˜Œé†‡åˆç”¨ï¼ˆå¯å¢åŠ éª¨é«“æŠ‘åˆ¶é£é™©ï¼‰",
                        "è‚²é¾„æœŸå¥³æ€§éœ€é¿å­•",
                        "å‡ºç°æ„ŸæŸ“è¿¹è±¡åŠæ—¶å°±åŒ»"
                    ],
                    "side_effects": ["éª¨é«“æŠ‘åˆ¶ï¼ˆç™½ç»†èƒå‡å°‘ï¼‰", "è‚åŠŸèƒ½å¼‚å¸¸", "èƒƒè‚ é“ååº”", "è„±å‘"],
                    "contraindications": ["ä¸¥é‡è‚è‚¾åŠŸèƒ½ä¸å…¨", "å¦Šå¨ æœŸ", "æ´»åŠ¨æ€§æ„ŸæŸ“", "éª¨é«“æŠ‘åˆ¶"]
                },
                {
                    "name": "ç¯å­¢ç´ ",
                    "generic_name": "Cyclosporine",
                    "dosage": "åˆå§‹å‰‚é‡ï¼š3-5mg/kg/å¤©ï¼Œåˆ†2æ¬¡å£æœï¼Œæ ¹æ®è¡€è¯æµ“åº¦è°ƒæ•´",
                    "indications": ["éš¾æ²»æ€§ç´«ç™œæ€§è‚¾ç‚", "æ¿€ç´ æŠµæŠ—å‹è¿‡æ•æ€§ç´«ç™œ", "å™¨å®˜ç§»æ¤æ’æ–¥ååº”"],
                    "mechanism": "æŠ‘åˆ¶Tç»†èƒæ´»åŒ–ï¼Œå‡å°‘IL-2ç­‰ç»†èƒå› å­äº§ç”Ÿ",
                    "precautions": [
                        "éœ€ç›‘æµ‹è¡€è¯æµ“åº¦ï¼ˆè°·æµ“åº¦100-200ng/mLï¼‰",
                        "å®šæœŸç›‘æµ‹è‚¾åŠŸèƒ½å’Œè¡€å‹ï¼ˆæ¯2-4å‘¨ï¼‰",
                        "é¿å…ä¸è‘¡è„æŸšæ±åŒæœï¼ˆå½±å“ä»£è°¢ï¼‰",
                        "æ³¨æ„è¯ç‰©ç›¸äº’ä½œç”¨ï¼ˆä¸å¤šç§è¯ç‰©æœ‰ç›¸äº’ä½œç”¨ï¼‰",
                        "å¯èƒ½å¼•èµ·ç‰™é¾ˆå¢ç”Ÿï¼Œæ³¨æ„å£è…”å«ç”Ÿ",
                        "å¯èƒ½å¼•èµ·å¤šæ¯›ï¼Œåœè¯åå¯é€†"
                    ],
                    "side_effects": ["è‚¾åŠŸèƒ½æŸå®³", "é«˜è¡€å‹", "ç‰™é¾ˆå¢ç”Ÿ", "å¤šæ¯›", "éœ‡é¢¤"],
                    "contraindications": ["è‚¾åŠŸèƒ½ä¸å…¨", "æœªæ§åˆ¶çš„é«˜è¡€å‹", "æ¶æ€§è‚¿ç˜¤"]
                },
                {
                    "name": "éœ‰é…šé…¸é…¯",
                    "generic_name": "Mycophenolate Mofetil",
                    "dosage": "æˆäººï¼šæ¯æ¬¡500-1000mgï¼Œæ¯æ—¥2æ¬¡",
                    "indications": ["ç‹¼ç–®æ€§è‚¾ç‚", "ç´«ç™œæ€§è‚¾ç‚", "è‚¾ç§»æ¤æ’æ–¥ååº”é¢„é˜²"],
                    "mechanism": "æŠ‘åˆ¶æ¬¡é»„å˜Œå‘¤å•æ ¸è‹·é…¸è„±æ°¢é…¶ï¼Œé€‰æ‹©æ€§æŠ‘åˆ¶æ·‹å·´ç»†èƒå¢æ®–",
                    "precautions": [
                        "ç©ºè…¹æˆ–é¥­å2å°æ—¶æœç”¨ï¼Œå¸æ”¶æ›´å¥½",
                        "å®šæœŸå¤æŸ¥è¡€å¸¸è§„ï¼ˆæ¯2-4å‘¨ï¼‰",
                        "å¯èƒ½å¼•èµ·è…¹æ³»ï¼Œå¿…è¦æ—¶åˆ†æ¬¡å°å‰‚é‡æœç”¨",
                        "è‚²é¾„å¦‡å¥³éœ€ä¸¥æ ¼é¿å­•ï¼ˆè‡´ç•¸é£é™©ï¼‰",
                        "é¿å…æ¥ç§æ´»ç–«è‹—"
                    ],
                    "side_effects": ["è…¹æ³»", "æ¶å¿ƒå‘•å", "ç™½ç»†èƒå‡å°‘", "è´«è¡€", "æ„ŸæŸ“é£é™©å¢åŠ "],
                    "contraindications": ["å¦Šå¨ æœŸ", "å“ºä¹³æœŸ", "ä¸¥é‡æ´»åŠ¨æ€§æ¶ˆåŒ–ç³»ç»Ÿç–¾ç—…"]
                },
                {
                    "name": "ç”²æ°¨è¶å‘¤",
                    "generic_name": "Methotrexate",
                    "dosage": "å°å‰‚é‡ï¼šæ¯å‘¨7.5-15mgï¼Œå•æ¬¡æˆ–åˆ†æ¬¡å£æœ",
                    "indications": ["ç±»é£æ¹¿å…³èŠ‚ç‚", "é“¶å±‘ç—…", "éš¾æ²»æ€§è¿‡æ•æ€§ç´«ç™œ"],
                    "mechanism": "å¶é…¸æ‹®æŠ—å‰‚ï¼ŒæŠ‘åˆ¶äºŒæ°¢å¶é…¸è¿˜åŸé…¶ï¼Œå¹²æ‰°DNAåˆæˆ",
                    "precautions": [
                        "æ¯å‘¨ç»™è¯ä¸€æ¬¡ï¼Œä¸æ˜¯æ¯å¤©ï¼ï¼ˆé‡è¦ï¼‰",
                        "åŒæ—¶è¡¥å……å¶é…¸ï¼ˆæ¯å‘¨5-10mgï¼Œé”™å¼€æœè¯æ—¥ï¼‰",
                        "å®šæœŸç›‘æµ‹è‚åŠŸèƒ½å’Œè¡€å¸¸è§„ï¼ˆæ¯4-8å‘¨ï¼‰",
                        "é¿å…é¥®é…’ï¼ˆå¢åŠ è‚æ¯’æ€§ï¼‰",
                        "è‚²é¾„æœŸç”·å¥³å‡éœ€é¿å­•ï¼ˆåœè¯3-6ä¸ªæœˆåå¯è€ƒè™‘å—å­•ï¼‰"
                    ],
                    "side_effects": ["å£è…”æºƒç–¡", "æ¶å¿ƒ", "è‚åŠŸèƒ½å¼‚å¸¸", "éª¨é«“æŠ‘åˆ¶", "è„±å‘"],
                    "contraindications": ["å¦Šå¨ æœŸ", "å“ºä¹³æœŸ", "ä¸¥é‡è‚è‚¾åŠŸèƒ½ä¸å…¨", "æ´»åŠ¨æ€§æ„ŸæŸ“"]
                }
            ],
            
            # æŠ—ç»„èƒºè¯
            "æŠ—ç»„èƒºè¯": [
                {
                    "name": "æ°¯é›·ä»–å®š",
                    "generic_name": "Loratadine",
                    "dosage": "æˆäººåŠ12å²ä»¥ä¸Šå„¿ç«¥ï¼šæ¯æ—¥10mgï¼Œç¡å‰æœç”¨",
                    "indications": ["è¿‡æ•æ€§ç´«ç™œçš®ç–¹", "è¨éº»ç–¹", "è¿‡æ•æ€§é¼»ç‚", "çš®è‚¤ç˜™ç—’"],
                    "mechanism": "ç¬¬äºŒä»£æŠ—ç»„èƒºè¯ï¼Œé€‰æ‹©æ€§é˜»æ–­H1å—ä½“ï¼Œæ— æ˜æ˜¾é•‡é™ä½œç”¨",
                    "precautions": [
                        "æ— å—œç¡å‰¯ä½œç”¨ï¼Œå¯ç™½å¤©æœç”¨",
                        "ä¸å½±å“é©¾é©¶å’Œç²¾å¯†æ“ä½œ",
                        "è‚åŠŸèƒ½ä¸å…¨è€…å‡é‡",
                        "èµ·æ•ˆè¾ƒå¿«ï¼ˆ1-3å°æ—¶ï¼‰ï¼Œç»´æŒ24å°æ—¶"
                    ],
                    "side_effects": ["è½»åº¦å¤´ç—›", "å£å¹²", "ç–²åŠ³ï¼ˆå°‘è§ï¼‰"],
                    "contraindications": ["å¯¹æœ¬å“è¿‡æ•è€…", "ä¸¥é‡è‚åŠŸèƒ½ä¸å…¨"]
                },
                {
                    "name": "è¥¿æ›¿åˆ©å—ª",
                    "generic_name": "Cetirizine",
                    "dosage": "æˆäººï¼šæ¯æ—¥10mgï¼Œç¡å‰æœç”¨ï¼›å„¿ç«¥ï¼ˆ2-6å²ï¼‰ï¼šæ¯æ—¥5mg",
                    "indications": ["è¿‡æ•æ€§ç´«ç™œ", "æ…¢æ€§è¨éº»ç–¹", "è¿‡æ•æ€§é¼»ç‚"],
                    "mechanism": "ç¬¬äºŒä»£æŠ—ç»„èƒºè¯ï¼Œé«˜åº¦é€‰æ‹©æ€§H1å—ä½“æ‹®æŠ—å‰‚",
                    "precautions": [
                        "è½»å¾®å—œç¡ï¼Œå»ºè®®æ™šä¸Šæœç”¨",
                        "è‚¾åŠŸèƒ½ä¸å…¨è€…éœ€è°ƒæ•´å‰‚é‡",
                        "èµ·æ•ˆå¿«ï¼ˆ20-60åˆ†é’Ÿï¼‰ï¼Œä½œç”¨æŒç»­24å°æ—¶"
                    ],
                    "side_effects": ["è½»åº¦å—œç¡", "å£å¹²", "ç–²åŠ³", "å¤´ç—›"],
                    "contraindications": ["ä¸¥é‡è‚¾åŠŸèƒ½ä¸å…¨", "å¯¹æœ¬å“è¿‡æ•"]
                }
            ],
            
            # è¡€ç®¡ä¿æŠ¤å‰‚
            "è¡€ç®¡ä¿æŠ¤å‰‚": [
                {
                    "name": "èŠ¦ä¸",
                    "generic_name": "Rutin",
                    "dosage": "æ¯æ¬¡20mgï¼Œæ¯æ—¥3æ¬¡",
                    "indications": ["è¡€ç®¡è„†æ€§å¢åŠ ", "è¿‡æ•æ€§ç´«ç™œ", "æ¯›ç»†è¡€ç®¡å‡ºè¡€æ€§ç–¾ç—…"],
                    "mechanism": "ç»´ç”Ÿç´ Pç±»ï¼Œå¢å¼ºæ¯›ç»†è¡€ç®¡å£ï¼Œé™ä½è¡€ç®¡é€šé€æ€§",
                    "precautions": [
                        "éœ€æŒç»­æœç”¨2-4å‘¨è§æ•ˆ",
                        "é¥­åæœç”¨",
                        "å¯ä¸ç»´ç”Ÿç´ Cåˆç”¨ï¼Œå¢å¼ºæ•ˆæœ"
                    ],
                    "side_effects": ["èƒƒéƒ¨ä¸é€‚ï¼ˆå°‘è§ï¼‰"],
                    "contraindications": ["æå°‘ï¼Œå¯¹æœ¬å“è¿‡æ•è€…é™¤å¤–"]
                },
                {
                    "name": "ç»´ç”Ÿç´ C",
                    "generic_name": "Ascorbic Acid",
                    "dosage": "æ¯æ—¥100-200mgï¼Œåˆ†æ¬¡æœç”¨",
                    "indications": ["è¾…åŠ©æ²»ç–—è¿‡æ•æ€§ç´«ç™œ", "å¢å¼ºè¡€ç®¡å£", "æé«˜å…ç–«åŠ›"],
                    "mechanism": "å‚ä¸èƒ¶åŸè›‹ç™½åˆæˆï¼Œå¢å¼ºè¡€ç®¡å£å¼ºåº¦",
                    "precautions": [
                        "å¤§å‰‚é‡å¯èƒ½å¼•èµ·è…¹æ³»",
                        "æœ‰è‚¾ç»“çŸ³å²è€…æ…ç”¨å¤§å‰‚é‡",
                        "ä¸èŠ¦ä¸åˆç”¨æ•ˆæœæ›´ä½³"
                    ],
                    "side_effects": ["è…¹æ³»ï¼ˆå¤§å‰‚é‡ï¼‰", "èƒƒéƒ¨ä¸é€‚"],
                    "contraindications": ["è‰é…¸ç›è‚¾ç»“çŸ³å²ï¼ˆå¤§å‰‚é‡ï¼‰"]
                },
                {
                    "name": "ç¾Ÿè‹¯ç£ºé…¸é’™",
                    "generic_name": "Calcium Dobesilate",
                    "dosage": "æ¯æ¬¡0.5gï¼Œæ¯æ—¥3æ¬¡",
                    "indications": ["ç³–å°¿ç—…æ€§å¾®è¡€ç®¡ç—…å˜", "é™è„‰æ›²å¼ ", "è¿‡æ•æ€§ç´«ç™œè¡€ç®¡æŸä¼¤"],
                    "mechanism": "é™ä½è¡€ç®¡é€šé€æ€§ï¼Œä¿æŠ¤è¡€ç®¡å†…çš®ï¼Œæ”¹å–„å¾®å¾ªç¯",
                    "precautions": [
                        "é¥­åæœç”¨",
                        "ç–—ç¨‹é€šå¸¸3-6ä¸ªæœˆ",
                        "å®šæœŸå¤æŸ¥è¡€å°æ¿"
                    ],
                    "side_effects": ["èƒƒè‚ é“ä¸é€‚", "çš®ç–¹ï¼ˆå°‘è§ï¼‰"],
                    "contraindications": ["å¯¹æœ¬å“è¿‡æ•", "ä¸¥é‡è‚è‚¾åŠŸèƒ½ä¸å…¨"]
                }
            ],
            
            # ä¸­æˆè¯
            "ä¸­æˆè¯": [
                {
                    "name": "é›·å…¬è—¤å¤šè‹·ç‰‡",
                    "generic_name": "Tripterygium Glycosides",
                    "dosage": "æ¯æ¬¡10-20mgï¼Œæ¯æ—¥3æ¬¡ï¼Œé¥­åæœç”¨",
                    "indications": ["éš¾æ²»æ€§è¿‡æ•æ€§ç´«ç™œ", "ç´«ç™œæ€§è‚¾ç‚", "ç±»é£æ¹¿å…³èŠ‚ç‚"],
                    "mechanism": "å…·æœ‰æŠ—ç‚ã€å…ç–«æŠ‘åˆ¶ä½œç”¨",
                    "precautions": [
                        "è‚²é¾„æœŸç”·å¥³ç¦ç”¨ï¼ˆå½±å“ç”Ÿè‚²åŠŸèƒ½ï¼‰",
                        "å®šæœŸç›‘æµ‹è‚è‚¾åŠŸèƒ½ã€è¡€å¸¸è§„ï¼ˆæ¯2-4å‘¨ï¼‰",
                        "å®šæœŸæ£€æŸ¥å¿ƒç”µå›¾",
                        "æ²»ç–—æœŸé—´åŠåœè¯å6ä¸ªæœˆå†…éœ€é¿å­•",
                        "èµ·æ•ˆè¾ƒæ…¢ï¼Œéœ€4-8å‘¨",
                        "ä¸å¯è¶…å‰‚é‡ä½¿ç”¨"
                    ],
                    "side_effects": ["æœˆç»ç´Šä¹±", "é—­ç»", "ç²¾å­å‡å°‘", "ç™½ç»†èƒå‡å°‘", "è‚åŠŸèƒ½å¼‚å¸¸", "èƒƒè‚ é“ååº”"],
                    "contraindications": ["å¦Šå¨ æœŸ", "å“ºä¹³æœŸ", "è®¡åˆ’ç”Ÿè‚²çš„ç”·å¥³", "ä¸¥é‡è‚è‚¾åŠŸèƒ½ä¸å…¨", "éª¨é«“æŠ‘åˆ¶"]
                },
                {
                    "name": "å¤æ–¹ç”˜è‰é…¸è‹·ç‰‡",
                    "generic_name": "Compound Glycyrrhizin",
                    "dosage": "æ¯æ¬¡2-3ç‰‡ï¼Œæ¯æ—¥3æ¬¡",
                    "indications": ["ä¿è‚", "æŠ—ç‚", "æŠ—è¿‡æ•", "è¾…åŠ©æ²»ç–—ç´«ç™œ"],
                    "mechanism": "å…·æœ‰ç±»ç³–çš®è´¨æ¿€ç´ ä½œç”¨ï¼ŒæŠ—ç‚ã€æŠ—è¿‡æ•ï¼Œä¿æŠ¤è‚ç»†èƒ",
                    "precautions": [
                        "é•¿æœŸä½¿ç”¨å¯èƒ½å¯¼è‡´ä½é’¾è¡€ç—‡ï¼Œéœ€ç›‘æµ‹ç”µè§£è´¨",
                        "å¯èƒ½å¼•èµ·æ°´é’ æ½´ç•™ã€è¡€å‹å‡é«˜",
                        "æœ‰é«˜è¡€å‹ã€å¿ƒè„ç—…è€…æ…ç”¨",
                        "å¯ä½œä¸ºæ¿€ç´ å‡é‡æ—¶çš„è¾…åŠ©ç”¨è¯"
                    ],
                    "side_effects": ["æ°´è‚¿", "è¡€å‹å‡é«˜", "ä½é’¾è¡€ç—‡", "è¡€ç³–å‡é«˜"],
                    "contraindications": ["é†›å›ºé…®å¢å¤šç—‡", "ä½é’¾è¡€ç—‡", "é«˜è¡€å‹ï¼ˆç›¸å¯¹ç¦å¿Œï¼‰"]
                }
            ]
        }
    
    def get_drugs_by_category(self, category: str) -> List[Dict[str, Any]]:
        """æ ¹æ®ç±»åˆ«è·å–è¯ç‰©åˆ—è¡¨"""
        return self.drugs.get(category, [])
    
    def get_random_drug_from_category(self, category: str) -> Optional[Dict[str, Any]]:
        """ä»æŸä¸ªç±»åˆ«éšæœºé€‰æ‹©ä¸€ä¸ªè¯ç‰©"""
        drugs = self.get_drugs_by_category(category)
        return random.choice(drugs) if drugs else None
    
    def get_top_drugs_from_category(self, category: str, n: int = 2) -> List[Dict[str, Any]]:
        """è·å–æŸç±»åˆ«æœ€å¸¸ç”¨çš„Nä¸ªè¯ç‰©"""
        drugs = self.get_drugs_by_category(category)
        return drugs[:min(n, len(drugs))]
    
    def format_drug_info(self, drug: Dict[str, Any], include_all: bool = True) -> str:
        """
        æ ¼å¼åŒ–è¯ç‰©ä¿¡æ¯ä¸ºå¯è¯»æ–‡æœ¬
        
        Args:
            drug: è¯ç‰©å­—å…¸
            include_all: æ˜¯å¦åŒ…å«æ‰€æœ‰ä¿¡æ¯
        """
        info = f"**{drug['name']}ï¼ˆ{drug['generic_name']}ï¼‰**\n"
        
        info += f"- **ç”¨æ³•ç”¨é‡**ï¼š{drug['dosage']}\n"
        
        if include_all:
            info += f"- **ä½œç”¨æœºåˆ¶**ï¼š{drug['mechanism']}\n"
        
        if drug.get('indications'):
            info += f"- **é€‚åº”ç—‡**ï¼š{', '.join(drug['indications'])}\n"
        
        info += "\n**âš ï¸ ç”¨è¯æ³¨æ„äº‹é¡¹**ï¼š\n"
        for i, precaution in enumerate(drug['precautions'], 1):
            info += f"{i}. {precaution}\n"
        
        if include_all and drug.get('side_effects'):
            info += f"\n**å¸¸è§å‰¯ä½œç”¨**ï¼š{', '.join(drug['side_effects'])}\n"
        
        if include_all and drug.get('contraindications'):
            info += f"\n**ç¦å¿Œç—‡**ï¼š{', '.join(drug['contraindications'])}\n"
        
        return info
    
    def generate_treatment_recommendation(
        self, 
        condition: str, 
        severity: str = "ä¸­ç­‰",
        patient_type: str = "æˆäºº"
    ) -> str:
        """
        ç”Ÿæˆæ²»ç–—å»ºè®®
        
        Args:
            condition: ç–¾ç—…/ç—‡çŠ¶
            severity: ä¸¥é‡ç¨‹åº¦ï¼ˆè½»åº¦/ä¸­ç­‰/é‡åº¦ï¼‰
            patient_type: æ‚£è€…ç±»å‹ï¼ˆå„¿ç«¥/æˆäºº/è€å¹´äººï¼‰
        """
        recommendations = []
        
        if "è¿‡æ•æ€§ç´«ç™œ" in condition:
            if severity == "è½»åº¦":
                # è½»åº¦ï¼šæŠ—ç»„èƒºè¯ + è¡€ç®¡ä¿æŠ¤å‰‚
                antihistamine = self.get_random_drug_from_category("æŠ—ç»„èƒºè¯")
                vascular_protector = self.get_drugs_by_category("è¡€ç®¡ä¿æŠ¤å‰‚")[0]
                
                recommendations.append(
                    f"é’ˆå¯¹æ‚¨ç›®å‰çš„è½»åº¦è¿‡æ•æ€§ç´«ç™œç—‡çŠ¶ï¼Œå»ºè®®è€ƒè™‘ä»¥ä¸‹æ²»ç–—æ–¹æ¡ˆï¼š\n\n"
                    f"**1. æŠ—è¿‡æ•æ²»ç–—**\n{self.format_drug_info(antihistamine)}\n"
                    f"**2. è¡€ç®¡ä¿æŠ¤æ²»ç–—**\n{self.format_drug_info(vascular_protector)}\n"
                )
                
            elif severity == "ä¸­ç­‰":
                # ä¸­ç­‰ï¼šéç”¾ä½“æŠ—ç‚è¯ + è¡€ç®¡ä¿æŠ¤å‰‚
                nsaid = self.get_drugs_by_category("éç”¾ä½“æŠ—ç‚è¯")[0]
                vascular_protector = self.get_drugs_by_category("è¡€ç®¡ä¿æŠ¤å‰‚")[0]
                antihistamine = self.get_random_drug_from_category("æŠ—ç»„èƒºè¯")
                
                recommendations.append(
                    f"æ ¹æ®æ‚¨çš„ä¸­åº¦è¿‡æ•æ€§ç´«ç™œç—‡çŠ¶ï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹æ²»ç–—æ–¹æ¡ˆï¼š\n\n"
                    f"**1. æŠ—ç‚é•‡ç—›æ²»ç–—**\n{self.format_drug_info(nsaid)}\n"
                    f"**2. è¡€ç®¡ä¿æŠ¤æ²»ç–—**\n{self.format_drug_info(vascular_protector)}\n"
                    f"**3. æŠ—è¿‡æ•æ²»ç–—**\n{self.format_drug_info(antihistamine, include_all=False)}\n"
                )
                
            else:  # é‡åº¦
                # é‡åº¦ï¼šç³–çš®è´¨æ¿€ç´  + å…ç–«è°ƒèŠ‚å‰‚
                steroid = self.get_drugs_by_category("ç³–çš®è´¨æ¿€ç´ ")[0]
                immunosuppressant = self.get_drugs_by_category("å…ç–«è°ƒèŠ‚å‰‚")[0]
                
                recommendations.append(
                    f"é‰´äºæ‚¨çš„é‡åº¦è¿‡æ•æ€§ç´«ç™œç—‡çŠ¶ï¼Œéœ€è¦æ›´ç§¯æçš„æ²»ç–—æ–¹æ¡ˆï¼š\n\n"
                    f"**1. ç³–çš®è´¨æ¿€ç´ æ²»ç–—ï¼ˆæ§åˆ¶æ€¥æ€§ç‚ç—‡ï¼‰**\n{self.format_drug_info(steroid)}\n"
                    f"**2. å…ç–«è°ƒèŠ‚æ²»ç–—ï¼ˆç»´æŒç¼“è§£ï¼‰**\n{self.format_drug_info(immunosuppressant)}\n\n"
                    f"âš ï¸ **é‡è¦æç¤º**ï¼šé‡åº¦ç´«ç™œéœ€è¦åœ¨ä¸“ç§‘åŒ»ç”ŸæŒ‡å¯¼ä¸‹è§„èŒƒæ²»ç–—ï¼Œåˆ‡å‹¿è‡ªè¡Œç”¨è¯ã€‚å»ºè®®å°½å¿«å°±è¯Šé£æ¹¿å…ç–«ç§‘æˆ–è‚¾å†…ç§‘ã€‚"
                )
        
        return "\n".join(recommendations)
    
    def search_drug_by_name(self, drug_name: str) -> Optional[Dict[str, Any]]:
        """æ ¹æ®è¯ç‰©åç§°æœç´¢"""
        for category, drugs in self.drugs.items():
            for drug in drugs:
                if drug_name in drug['name'] or drug_name in drug['generic_name']:
                    return drug
        return None
    
    def get_all_categories(self) -> List[str]:
        """è·å–æ‰€æœ‰è¯ç‰©ç±»åˆ«"""
        return list(self.drugs.keys())
    
    def export_to_json(self, filepath: str):
        """å¯¼å‡ºè¯ç‰©æ•°æ®åº“åˆ°JSONæ–‡ä»¶"""
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(self.drugs, f, ensure_ascii=False, indent=2)
        print(f"âœ… è¯ç‰©çŸ¥è¯†åº“å·²å¯¼å‡ºåˆ°: {filepath}")


# ç¤ºä¾‹ä½¿ç”¨
if __name__ == "__main__":
    from rich.console import Console
    from rich.panel import Panel
    
    console = Console()
    kb = DrugKnowledgeBase()
    
    console.print(Panel.fit(
        "[bold green]ğŸ’Š è¯ç‰©çŸ¥è¯†åº“ç³»ç»Ÿ[/bold green]\n"
        f"å…±åŒ…å« {len(kb.get_all_categories())} ä¸ªè¯ç‰©ç±»åˆ«",
        border_style="green"
    ))
    
    # å±•ç¤ºæ‰€æœ‰ç±»åˆ«
    console.print("\n[bold blue]ğŸ“‹ è¯ç‰©ç±»åˆ«åˆ—è¡¨ï¼š[/bold blue]")
    for i, category in enumerate(kb.get_all_categories(), 1):
        drug_count = len(kb.get_drugs_by_category(category))
        console.print(f"{i}. {category} ({drug_count} ç§è¯ç‰©)")
    
    # ç¤ºä¾‹ï¼šç”Ÿæˆè¿‡æ•æ€§ç´«ç™œæ²»ç–—å»ºè®®
    console.print("\n[bold blue]ğŸ“ ç¤ºä¾‹ï¼šä¸­åº¦è¿‡æ•æ€§ç´«ç™œæ²»ç–—æ–¹æ¡ˆ[/bold blue]")
    recommendation = kb.generate_treatment_recommendation("è¿‡æ•æ€§ç´«ç™œ", severity="ä¸­ç­‰")
    console.print(recommendation)
    
    # å¯¼å‡ºæ•°æ®åº“
    kb.export_to_json("drug_knowledge_base.json")

